<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>OPERACIONES COMBINADAS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-page: #e8edf5;
      --bg-card: #ffffff;
      --border-card: #d0d7e2;
      --text-main: #1f2933;
      --text-muted: #6b7280;
      --primary: #2563eb;
      --primary-hover: #1d4ed8;
      --input-border: #cbd5e1;
      --correct-bg: #dcfce7;
      --correct-border: #16a34a;
      --correct-text: #166534;
      --incorrect-bg: #fee2e2;
      --incorrect-border: #dc2626;
      --incorrect-text: #991b1b;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 16px;
      background: var(--bg-page);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      color: var(--text-main);
      display: flex;
      justify-content: center;
    }

    .app-container {
      width: 100%;
      max-width: 640px;
    }

    .card {
      background: var(--bg-card);
      border-radius: 14px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      border: 1px solid var(--border-card);
      padding: 20px 18px 22px;
    }

    @media (min-width: 768px) {
      .card {
        padding: 24px 24px 26px;
      }
    }

    .title {
      font-size: 1.5rem;
      font-weight: 700;
      text-align: center;
      margin-bottom: 4px;
      letter-spacing: 0.03em;
    }

    .subtitle {
      font-size: 0.95rem;
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 4px;
    }

    .line-small {
      font-size: 0.8rem;
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .section-label {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 600px) {
      .grid-3 {
        grid-template-columns: 1.1fr 1.1fr 0.9fr;
      }
    }

    label {
      font-size: 0.82rem;
      display: block;
      margin-bottom: 3px;
      color: var(--text-muted);
    }

    input[type="text"],
    select {
      width: 100%;
      padding: 7px 9px;
      border-radius: 8px;
      border: 1px solid var(--input-border);
      font-size: 0.9rem;
      outline: none;
      background: #f9fafb;
    }

    input[type="text"]:focus,
    select:focus {
      border-color: var(--primary);
      background: #ffffff;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.1);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 8px 16px;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 600;
      transition: background 0.15s ease, transform 0.05s ease;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary);
      color: #ffffff;
    }

    .btn-primary:hover {
      background: var(--primary-hover);
      transform: translateY(-0.5px);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .btn-sign {
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--input-border);
      background: #e5e7eb;
      color: var(--text-main);
      font-size: 0.85rem;
      cursor: pointer;
      min-width: 38px;
    }

    .btn-sign:active {
      transform: translateY(0.5px);
    }

    .datos-guardados {
      margin-top: 10px;
      padding: 8px 10px;
      border-radius: 10px;
      background: #f3f4f6;
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .datos-guardados span {
      font-weight: 600;
      color: var(--text-main);
    }

    .ejercicio-header {
      margin-top: 18px;
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
      flex-wrap: wrap;
    }

    .ejercicio-titulo {
      font-size: 0.95rem;
      font-weight: 600;
      color: var(--text-main);
    }

    .aciertos {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .expr-box {
      margin-top: 6px;
      margin-bottom: 10px;
      padding: 12px 14px;
      border-radius: 12px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      min-height: 64px;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.05rem;
      font-weight: 600;
      letter-spacing: 0.02em;
      word-break: break-word;
    }

    .respuesta-row {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 10px;
    }

    @media (min-width: 520px) {
      .respuesta-row {
        flex-direction: row;
        align-items: center;
      }
      .respuesta-row .respuesta-input-wrapper {
        flex: 1;
      }
    }

    .respuesta-input-wrapper {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .respuesta-input-inline {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .respuesta-input-inline input {
      flex: 1;
    }

    .respuesta-input-wrapper small {
      font-size: 0.78rem;
      color: var(--text-muted);
    }

    #answerInput {
      background: #f9fafb;
    }

    .feedback {
      margin-top: 8px;
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 0.88rem;
      display: none;
    }

    .feedback.correcto {
      display: block;
      background: var(--correct-bg);
      color: var(--correct-text);
      border: 1px solid var(--correct-border);
    }

    .feedback.incorrecto {
      display: block;
      background: var(--incorrect-bg);
      color: var(--incorrect-text);
      border: 1px solid var(--incorrect-border);
    }

    .explicacion {
      margin-top: 6px;
      font-size: 0.86rem;
      color: var(--text-main);
      background: #f9fafb;
      border-radius: 10px;
      padding: 8px 10px;
      border: 1px dashed #e5e7eb;
      white-space: pre-line;
      display: none;
    }

    .resumen-box {
      margin-top: 14px;
      padding: 12px;
      border-radius: 12px;
      background: #eff6ff;
      border: 1px solid #bfdbfe;
      font-size: 0.9rem;
      display: none;
    }

    .resumen-box h3 {
      margin: 0 0 6px;
      font-size: 1rem;
      font-weight: 700;
      color: var(--primary-hover);
    }

    .resumen-box p {
      margin: 2px 0;
    }

    .resumen-box .nota {
      margin-top: 8px;
      font-size: 0.82rem;
      color: var(--text-muted);
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="card">
      <div class="title">OPERACIONES COMBINADAS</div>
      <div class="subtitle">Aplicación por niveles · 15 ítems por sesión</div>
      <div class="line-small">PENSAMIENTO MATEMÁTICO 1 · by Mtra. Adriana Arroyo</div>

      <div class="section-label">Datos del estudiante</div>
      <div class="grid grid-3" style="margin-bottom: 4px;">
        <div>
          <label for="studentName">Nombre</label>
          <input type="text" id="studentName" placeholder="Escribe tu nombre">
        </div>
        <div>
          <label for="studentGroup">Grupo</label>
          <input type="text" id="studentGroup" placeholder="Ej. 1°A, 1°B">
        </div>
        <div>
          <label for="levelSelect">Nivel</label>
          <select id="levelSelect">
            <option value="basico">Básico</option>
            <option value="ampliado">Ampliado</option>
            <option value="super">Súper avanzado</option>
          </select>
        </div>
      </div>
      <button id="saveButton" class="btn btn-primary" type="button">Guardar datos</button>

      <div class="datos-guardados" id="datosGuardados">
        Nombre: <span id="displayNombre">---</span> ·
        Grupo: <span id="displayGrupo">---</span> ·
        Nivel: <span id="displayNivel">---</span>
      </div>

      <div class="ejercicio-header">
        <div class="ejercicio-titulo" id="ejercicioHeader">Ejercicio 0 de 15</div>
        <div class="aciertos">Aciertos hasta ahora: <span id="aciertosSpan">0</span></div>
      </div>

      <div class="expr-box" id="exprBox">Guarda tus datos para iniciar la sesión.</div>

      <div class="respuesta-row">
        <div class="respuesta-input-wrapper">
          <label for="answerInput">Escribe tu resultado:</label>
          <div class="respuesta-input-inline">
            <input
              type="text"
              id="answerInput"
              autocomplete="off"
              placeholder="Ej. -5 o 12.5"
            >
          </div>
          <small>
            Escribe solo números enteros o decimales (pueden ser negativos).
            No uses fracciones con “/”, por ejemplo escribe 1.5 en lugar de 3/2.
          </small>
        </div>
        <div>
          <button id="actionButton" class="btn btn-primary" type="button">Responder</button>
        </div>
      </div>

      <div id="feedback" class="feedback"></div>
      <div id="explanation" class="explicacion"></div>

      <div id="resumenBox" class="resumen-box">
        <h3>Resumen de sesión</h3>
        <p><strong>Nombre:</strong> <span id="summaryNombre"></span></p>
        <p><strong>Grupo:</strong> <span id="summaryGrupo"></span></p>
        <p><strong>Nivel:</strong> <span id="summaryNivel"></span></p>
        <p><strong>Aciertos:</strong> <span id="summaryAciertos"></span> de 15</p>
        <p><strong>Porcentaje:</strong> <span id="summaryPorcentaje"></span>%</p>
        <p><strong>Fecha y hora:</strong> <span id="summaryFecha"></span></p>
        <p class="nota">Toma captura de pantalla de este recuadro como evidencia de tu sesión.</p>
      </div>
    </div>
  </div>

  <script>
    // ----- Banco de reactivos -----

    const reactivosBasicos = [
      {
        expr: "3 + 5 × 2",
        answer: 13,
        explanation: "1) Aplicamos primero la multiplicación: 5 × 2 = 10.\n2) Sumamos: 3 + 10 = 13.\n3) El resultado final es 13."
      },
      {
        expr: "(8 - 3) × 4",
        answer: 20,
        explanation: "1) Resolvemos el paréntesis: 8 - 3 = 5.\n2) Multiplicamos: 5 × 4 = 20.\n3) El resultado final es 20."
      },
      {
        expr: "12 ÷ 3 + 5",
        answer: 9,
        explanation: "1) Primero la división: 12 ÷ 3 = 4.\n2) Luego sumamos: 4 + 5 = 9.\n3) El resultado final es 9."
      },
      {
        expr: "18 - 2 × 5",
        answer: 8,
        explanation: "1) Calculamos la multiplicación: 2 × 5 = 10.\n2) Restamos: 18 - 10 = 8.\n3) El resultado final es 8."
      },
      {
        expr: "(6 + 4) ÷ 2",
        answer: 5,
        explanation: "1) Resolvemos el paréntesis: 6 + 4 = 10.\n2) Dividimos: 10 ÷ 2 = 5.\n3) El resultado final es 5."
      },
      {
        expr: "7 + 2^2",
        answer: 11,
        explanation: "1) Calculamos la potencia: 2^2 = 4.\n2) Sumamos: 7 + 4 = 11.\n3) El resultado final es 11."
      },
      {
        expr: "5 × (3 + 1)",
        answer: 20,
        explanation: "1) Resolvemos el paréntesis: 3 + 1 = 4.\n2) Multiplicamos: 5 × 4 = 20.\n3) El resultado final es 20."
      },
      {
        expr: "9 - (2 + 3)",
        answer: 4,
        explanation: "1) Resolvemos el paréntesis: 2 + 3 = 5.\n2) Restamos: 9 - 5 = 4.\n3) El resultado final es 4."
      },
      {
        expr: "4 × 3 - 5",
        answer: 7,
        explanation: "1) Calculamos la multiplicación: 4 × 3 = 12.\n2) Restamos: 12 - 5 = 7.\n3) El resultado final es 7."
      },
      {
        expr: "2^3 + 1",
        answer: 9,
        explanation: "1) Calculamos la potencia: 2^3 = 8.\n2) Sumamos: 8 + 1 = 9.\n3) El resultado final es 9."
      },
      {
        expr: "15 ÷ (1 + 2)",
        answer: 5,
        explanation: "1) Resolvemos el paréntesis: 1 + 2 = 3.\n2) Dividimos: 15 ÷ 3 = 5.\n3) El resultado final es 5."
      },
      {
        expr: "(10 - 4) × 2",
        answer: 12,
        explanation: "1) Resolvemos el paréntesis: 10 - 4 = 6.\n2) Multiplicamos: 6 × 2 = 12.\n3) El resultado final es 12."
      },
      {
        expr: "20 ÷ 5 + 6",
        answer: 10,
        explanation: "1) Primero la división: 20 ÷ 5 = 4.\n2) Luego sumamos: 4 + 6 = 10.\n3) El resultado final es 10."
      },
      {
        expr: "2 × (7 - 3)",
        answer: 8,
        explanation: "1) Resolvemos el paréntesis: 7 - 3 = 4.\n2) Multiplicamos: 2 × 4 = 8.\n3) El resultado final es 8."
      },
      {
        expr: "9 + 6 ÷ 3",
        answer: 11,
        explanation: "1) Primero la división: 6 ÷ 3 = 2.\n2) Sumamos: 9 + 2 = 11.\n3) El resultado final es 11."
      },
      {
        expr: "2 × 2 × 2 + 1",
        answer: 9,
        explanation: "1) Multiplicamos en orden: 2 × 2 = 4 y 4 × 2 = 8.\n2) Sumamos: 8 + 1 = 9.\n3) El resultado final es 9."
      },
      {
        expr: "5 + 3 × (4 - 2)",
        answer: 11,
        explanation: "1) Resolvemos el paréntesis: 4 - 2 = 2.\n2) Multiplicamos: 3 × 2 = 6.\n3) Sumamos: 5 + 6 = 11."
      },
      {
        expr: "(9 - 1) ÷ 2",
        answer: 4,
        explanation: "1) Resolvemos el paréntesis: 9 - 1 = 8.\n2) Dividimos: 8 ÷ 2 = 4.\n3) El resultado final es 4."
      },
      {
        expr: "7 - 2^2",
        answer: 3,
        explanation: "1) Calculamos la potencia: 2^2 = 4.\n2) Restamos: 7 - 4 = 3.\n3) El resultado final es 3."
      },
      {
        expr: "(3 - 7) × 2",
        answer: -8,
        explanation: "1) Resolvemos el paréntesis: 3 - 7 = -4.\n2) Multiplicamos: -4 × 2 = -8.\n3) El resultado final es -8."
      },
      {
        expr: "16 ÷ 4 + 2",
        answer: 6,
        explanation: "1) Primero la división: 16 ÷ 4 = 4.\n2) Sumamos: 4 + 2 = 6.\n3) El resultado final es 6."
      },
      {
        expr: "2 + 3 × 4",
        answer: 14,
        explanation: "1) Calculamos la multiplicación: 3 × 4 = 12.\n2) Sumamos: 2 + 12 = 14.\n3) El resultado final es 14."
      },
      {
        expr: "(5 + 7) - 3",
        answer: 9,
        explanation: "1) Resolvemos el paréntesis: 5 + 7 = 12.\n2) Restamos: 12 - 3 = 9.\n3) El resultado final es 9."
      },
      {
        expr: "6 × 2 - 3",
        answer: 9,
        explanation: "1) Multiplicamos: 6 × 2 = 12.\n2) Restamos: 12 - 3 = 9.\n3) El resultado final es 9."
      },
      {
        expr: "2 - 5 × 3",
        answer: -13,
        explanation: "1) Calculamos la multiplicación: 5 × 3 = 15.\n2) Restamos: 2 - 15 = -13.\n3) El resultado final es -13."
      }
    ];

    const reactivosAmpliados = [
      {
        expr: "(8 + 2 × 3) - 4",
        answer: 10,
        explanation: "1) Primero multiplicamos: 2 × 3 = 6 y sumamos: 8 + 6 = 14.\n2) Restamos: 14 - 4 = 10.\n3) El resultado final es 10."
      },
      {
        expr: "[10 - (3 + 1)] × 2",
        answer: 12,
        explanation: "1) En el paréntesis: 3 + 1 = 4.\n2) En el corchete: 10 - 4 = 6.\n3) Multiplicamos: 6 × 2 = 12."
      },
      {
        expr: "6 × (2^2) - 5",
        answer: 19,
        explanation: "1) Calculamos la potencia: 2^2 = 4.\n2) Multiplicamos: 6 × 4 = 24.\n3) Restamos: 24 - 5 = 19."
      },
      {
        expr: "20 ÷ (2 + 3) + 4",
        answer: 8,
        explanation: "1) Paréntesis: 2 + 3 = 5.\n2) División: 20 ÷ 5 = 4.\n3) Sumamos: 4 + 4 = 8."
      },
      {
        expr: "√16 + 3^2",
        answer: 13,
        explanation: "1) Raíz: √16 = 4.\n2) Potencia: 3^2 = 9.\n3) Sumamos: 4 + 9 = 13."
      },
      {
        expr: "5 × [4 + (6 ÷ 3)]",
        answer: 30,
        explanation: "1) Paréntesis interno: 6 ÷ 3 = 2.\n2) Corchete: 4 + 2 = 6.\n3) Multiplicamos: 5 × 6 = 30."
      },
      {
        expr: "(18 ÷ 3) + 2^2",
        answer: 10,
        explanation: "1) División: 18 ÷ 3 = 6.\n2) Potencia: 2^2 = 4.\n3) Sumamos: 6 + 4 = 10."
      },
      {
        expr: "7^2 - (10 + 3)",
        answer: 36,
        explanation: "1) Potencia: 7^2 = 49.\n2) Paréntesis: 10 + 3 = 13.\n3) Restamos: 49 - 13 = 36."
      },
      {
        expr: "(4 + 6) × (3 - 1)",
        answer: 20,
        explanation: "1) Primer paréntesis: 4 + 6 = 10.\n2) Segundo paréntesis: 3 - 1 = 2.\n3) Multiplicamos: 10 × 2 = 20."
      },
      {
        expr: "√25 × (8 - 3)",
        answer: 25,
        explanation: "1) Raíz: √25 = 5.\n2) Paréntesis: 8 - 3 = 5.\n3) Multiplicamos: 5 × 5 = 25."
      },
      {
        expr: "30 ÷ (2 × 3) + 5",
        answer: 10,
        explanation: "1) Multiplicación: 2 × 3 = 6.\n2) División: 30 ÷ 6 = 5.\n3) Sumamos: 5 + 5 = 10."
      },
      {
        expr: "4^2 + 6 ÷ 3",
        answer: 18,
        explanation: "1) Potencia: 4^2 = 16.\n2) División: 6 ÷ 3 = 2.\n3) Sumamos: 16 + 2 = 18."
      },
      {
        expr: "[20 - 4^2] ÷ 2",
        answer: 2,
        explanation: "1) Potencia: 4^2 = 16.\n2) Corchete: 20 - 16 = 4.\n3) División: 4 ÷ 2 = 2."
      },
      {
        expr: "3 × (5 + 2^2)",
        answer: 27,
        explanation: "1) Potencia: 2^2 = 4.\n2) Paréntesis: 5 + 4 = 9.\n3) Multiplicamos: 3 × 9 = 27."
      },
      {
        expr: "√36 + (18 ÷ 3)",
        answer: 12,
        explanation: "1) Raíz: √36 = 6.\n2) Paréntesis: 18 ÷ 3 = 6.\n3) Sumamos: 6 + 6 = 12."
      },
      {
        expr: "(5^2 - 9) ÷ 2",
        answer: 8,
        explanation: "1) Potencia: 5^2 = 25.\n2) Resta: 25 - 9 = 16.\n3) División: 16 ÷ 2 = 8."
      },
      {
        expr: "6 × (√16 - 1)",
        answer: 18,
        explanation: "1) Raíz: √16 = 4.\n2) Paréntesis: 4 - 1 = 3.\n3) Multiplicamos: 6 × 3 = 18."
      },
      {
        expr: "(40 ÷ 5) + 3^2",
        answer: 17,
        explanation: "1) División: 40 ÷ 5 = 8.\n2) Potencia: 3^2 = 9.\n3) Sumamos: 8 + 9 = 17."
      },
      {
        expr: "[30 - (4 × 3)] ÷ 3",
        answer: 6,
        explanation: "1) Paréntesis: 4 × 3 = 12.\n2) Corchete: 30 - 12 = 18.\n3) División: 18 ÷ 3 = 6."
      },
      {
        expr: "2^3 + √64 - 5",
        answer: 11,
        explanation: "1) Potencia: 2^3 = 8.\n2) Raíz: √64 = 8.\n3) Sumamos y restamos: 8 + 8 - 5 = 11."
      },
      {
        expr: "(7 × 3) - √49 + 2",
        answer: 16,
        explanation: "1) Multiplicación: 7 × 3 = 21.\n2) Raíz: √49 = 7.\n3) Operamos: 21 - 7 + 2 = 16."
      },
      {
        expr: "(50 ÷ 5) - 2^2 + 1",
        answer: 7,
        explanation: "1) División: 50 ÷ 5 = 10.\n2) Potencia: 2^2 = 4.\n3) Operamos: 10 - 4 + 1 = 7."
      },
      {
        expr: "√81 - (6 + 3^2)",
        answer: -6,
        explanation: "1) Raíz: √81 = 9.\n2) Potencia: 3^2 = 9 y paréntesis: 6 + 9 = 15.\n3) Restamos: 9 - 15 = -6."
      },
      {
        expr: "[18 - (√9 + 1)] × 2",
        answer: 28,
        explanation: "1) Raíz: √9 = 3.\n2) Paréntesis: 3 + 1 = 4.\n3) Corchete: 18 - 4 = 14; luego 14 × 2 = 28."
      },
      {
        expr: "3^2 + 4^2 - √100",
        answer: 15,
        explanation: "1) Potencias: 3^2 = 9 y 4^2 = 16.\n2) Sumamos: 9 + 16 = 25.\n3) Raíz: √100 = 10; 25 - 10 = 15."
      },
      {
        expr: "(6 + 2) × (5 - √9)",
        answer: 16,
        explanation: "1) Raíz: √9 = 3.\n2) Paréntesis: 6 + 2 = 8 y 5 - 3 = 2.\n3) Multiplicamos: 8 × 2 = 16."
      },
      {
        expr: "√121 ÷ 11 + 7",
        answer: 8,
        explanation: "1) Raíz: √121 = 11.\n2) División: 11 ÷ 11 = 1.\n3) Sumamos: 1 + 7 = 8."
      },
      {
        expr: "5 × (√25 - 2) + 3",
        answer: 18,
        explanation: "1) Raíz: √25 = 5.\n2) Paréntesis: 5 - 2 = 3.\n3) Multiplicamos: 5 × 3 = 15 y sumamos 3: 15 + 3 = 18."
      },
      {
        expr: "(3^2 + 4^2) ÷ 5",
        answer: 5,
        explanation: "1) Potencias: 3^2 = 9 y 4^2 = 16.\n2) Sumamos: 9 + 16 = 25.\n3) Dividimos: 25 ÷ 5 = 5."
      },
      {
        expr: "[√64 + 2^3] - 3",
        answer: 13,
        explanation: "1) Raíz: √64 = 8.\n2) Potencia: 2^3 = 8; sumamos 8 + 8 = 16.\n3) Restamos: 16 - 3 = 13."
      }
    ];

    const reactivosSuperAvanzados = [
      {
        expr: "{[2^3 + 4^2] - (√36 ÷ 3)} + 5 - 7",
        answer: 20,
        explanation: "1) Calculamos potencias y raíz: 2^3 = 8, 4^2 = 16, √36 = 6.\n2) Operamos: 8 + 16 = 24; 6 ÷ 3 = 2; 24 - 2 = 22; 22 + 5 - 7 = 20.\n3) El resultado final es 20."
      },
      {
        expr: "{10 - [3 × (2^2 - 1)]} + √49 - 2",
        answer: 6,
        explanation: "1) Potencia: 2^2 = 4; paréntesis: 4 - 1 = 3; luego 3 × 3 = 9.\n2) Corchete: 10 - 9 = 1; raíz: √49 = 7.\n3) Operamos: 1 + 7 - 2 = 6."
      },
      {
        expr: "[5^2 - (√25 + 3)] × 2 - 4",
        answer: 30,
        explanation: "1) Potencia y raíz: 5^2 = 25, √25 = 5; paréntesis: 5 + 3 = 8.\n2) Corchete: 25 - 8 = 17; luego 17 × 2 = 34.\n3) Restamos: 34 - 4 = 30."
      },
      {
        expr: "{(3^3 - 2^2) + [√64 - 6]} ÷ 2",
        answer: 12.5,
        explanation: "1) Potencias: 3^3 = 27 y 2^2 = 4; raíz: √64 = 8.\n2) Operamos: 27 - 4 = 23; 8 - 6 = 2; 23 + 2 = 25.\n3) Dividimos: 25 ÷ 2 = 12.5."
      },
      {
        expr: "(√81 + 2^4) - {3 × [4 + (2^2)]}",
        answer: 1,
        explanation: "1) Raíz y potencias: √81 = 9, 2^4 = 16, 2^2 = 4.\n2) Paréntesis: 4 + 4 = 8; luego 3 × 8 = 24.\n3) Sumamos y restamos: 9 + 16 = 25; 25 - 24 = 1."
      },
      {
        expr: "{[6^2 - √36] ÷ 3} + 2^3 - 5",
        answer: 13,
        explanation: "1) Potencia y raíz: 6^2 = 36, √36 = 6.\n2) Corchete: 36 - 6 = 30; división: 30 ÷ 3 = 10.\n3) Potencia: 2^3 = 8; operamos: 10 + 8 - 5 = 13."
      },
      {
        expr: "[4 × (3^2 - 5)] + √49 - 8",
        answer: 15,
        explanation: "1) Potencia: 3^2 = 9; paréntesis: 9 - 5 = 4.\n2) Multiplicación: 4 × 4 = 16; raíz: √49 = 7.\n3) Operamos: 16 + 7 - 8 = 15."
      },
      {
        expr: "{√100 - [2 × (3^2 + 1)]} + 4",
        answer: -6,
        explanation: "1) Raíz y potencia: √100 = 10, 3^2 = 9; paréntesis: 9 + 1 = 10.\n2) Corchete: 2 × 10 = 20; luego 10 - 20 = -10.\n3) Sumamos: -10 + 4 = -6."
      },
      {
        expr: "{(2^4 - 3^2) - [√49 + 1]} × 2",
        answer: -2,
        explanation: "1) Potencias y raíz: 2^4 = 16, 3^2 = 9, √49 = 7.\n2) Paréntesis: 16 - 9 = 7; corchete: 7 + 1 = 8.\n3) Operamos: 7 - 8 = -1; luego -1 × 2 = -2."
      },
      {
        expr: "[5 × (√64 - 2^2)] + 3 - 7",
        answer: 16,
        explanation: "1) Raíz y potencia: √64 = 8, 2^2 = 4; paréntesis: 8 - 4 = 4.\n2) Multiplicación: 5 × 4 = 20.\n3) Operamos: 20 + 3 - 7 = 16."
      },
      {
        expr: "{(4^3 ÷ 8) + √36 - 5} × 2",
        answer: 18,
        explanation: "1) Potencia: 4^3 = 64; división: 64 ÷ 8 = 8; raíz: √36 = 6.\n2) Sumamos y restamos: 8 + 6 - 5 = 9.\n3) Multiplicamos: 9 × 2 = 18."
      },
      {
        expr: "[7^2 - (√49 + 4)] ÷ 2 + 2",
        answer: 21,
        explanation: "1) Potencia y raíz: 7^2 = 49, √49 = 7; paréntesis: 7 + 4 = 11.\n2) Corchete: 49 - 11 = 38; división: 38 ÷ 2 = 19.\n3) Sumamos: 19 + 2 = 21."
      },
      {
        expr: "{3 × [5^2 - (√25 + 2)]} - 4",
        answer: 50,
        explanation: "1) Potencia y raíz: 5^2 = 25, √25 = 5; paréntesis: 5 + 2 = 7.\n2) Corchete: 25 - 7 = 18; luego 3 × 18 = 54.\n3) Restamos: 54 - 4 = 50."
      },
      {
        expr: "[2^5 - (√64 + 4)] ÷ 2 + 1",
        answer: 11,
        explanation: "1) Potencias y raíz: 2^5 = 32, √64 = 8.\n2) Paréntesis: 8 + 4 = 12; luego 32 - 12 = 20.\n3) División y suma: 20 ÷ 2 = 10; 10 + 1 = 11."
      },
      {
        expr: "{√121 + 3^3 - [2 × (4^2 - 5)]}",
        answer: 16,
        explanation: "1) Raíz y potencias: √121 = 11, 3^3 = 27, 4^2 = 16.\n2) Paréntesis: 16 - 5 = 11; producto: 2 × 11 = 22.\n3) Operamos: 11 + 27 - 22 = 16."
      },
      {
        expr: "{[3^3 - 4^2] - (√81 - 10)} × (-1)",
        answer: -12,
        explanation: "1) Potencias y raíz: 3^3 = 27, 4^2 = 16, √81 = 9.\n2) Corchete: 27 - 16 = 11; paréntesis: 9 - 10 = -1.\n3) Operamos: 11 - (-1) = 12; 12 × (-1) = -12."
      },
      {
        expr: "(√144 ÷ 12) + {5^2 - [3 × (2^2)]}",
        answer: 14,
        explanation: "1) Raíz y potencias: √144 = 12, 5^2 = 25, 2^2 = 4.\n2) División: 12 ÷ 12 = 1; corchete interno: 3 × 4 = 12.\n3) Operamos: 25 - 12 = 13; 1 + 13 = 14."
      },
      {
        expr: "{[6^2 - 4^2] ÷ 2} + √49 - 9",
        answer: 8,
        explanation: "1) Potencias: 6^2 = 36 y 4^2 = 16; resta: 36 - 16 = 20.\n2) División: 20 ÷ 2 = 10; raíz: √49 = 7.\n3) Operamos: 10 + 7 - 9 = 8."
      },
      {
        expr: "[8^2 ÷ 4] - {√64 + (3^2 - 1)}",
        answer: 0,
        explanation: "1) Potencias y raíz: 8^2 = 64, 3^2 = 9, √64 = 8.\n2) División: 64 ÷ 4 = 16; paréntesis: 9 - 1 = 8.\n3) Operamos: 8 + 8 = 16; 16 - 16 = 0."
      },
      {
        expr: "{2 × (3^3 - √36)} - [4^2 - 5]",
        answer: 31,
        explanation: "1) Potencias y raíz: 3^3 = 27, √36 = 6, 4^2 = 16.\n2) Paréntesis: 27 - 6 = 21; producto: 2 × 21 = 42.\n3) Corchete: 16 - 5 = 11; luego 42 - 11 = 31."
      },
      {
        expr: "[5^2 + √36 - 4^2] × 2 - 3",
        answer: 27,
        explanation: "1) Potencias y raíz: 5^2 = 25, 4^2 = 16, √36 = 6.\n2) Corchete: 25 + 6 - 16 = 15.\n3) Multiplicamos y restamos: 15 × 2 = 30; 30 - 3 = 27."
      },
      {
        expr: "{(7^2 - √49) ÷ 2} + [3^2 - 1]",
        answer: 29,
        explanation: "1) Potencias y raíz: 7^2 = 49, √49 = 7, 3^2 = 9.\n2) División: (49 - 7) ÷ 2 = 42 ÷ 2 = 21.\n3) Corchete: 9 - 1 = 8; luego 21 + 8 = 29."
      },
      {
        expr: "[9^2 - (√81 + 2^3)] ÷ 5",
        answer: 12.8,
        explanation: "1) Potencias y raíz: 9^2 = 81, √81 = 9, 2^3 = 8.\n2) Paréntesis: 9 + 8 = 17; resta: 81 - 17 = 64.\n3) División: 64 ÷ 5 = 12.8."
      },
      {
        expr: "{√100 + 4^2 - [3 × (2^2 + 1)]}",
        answer: 11,
        explanation: "1) Raíz y potencias: √100 = 10, 4^2 = 16, 2^2 = 4.\n2) Paréntesis: 4 + 1 = 5; producto: 3 × 5 = 15.\n3) Operamos: 10 + 16 - 15 = 11."
      },
      {
        expr: "[2^4 + 3^2 - √49] × (-2)",
        answer: -36,
        explanation: "1) Potencias y raíz: 2^4 = 16, 3^2 = 9, √49 = 7.\n2) Corchete: 16 + 9 - 7 = 18.\n3) Multiplicamos: 18 × (-2) = -36."
      },
      {
        expr: "{(5^3 ÷ 5) - [√25 + 2^2]} + 1",
        answer: 17,
        explanation: "1) Potencias y raíz: 5^3 = 125, √25 = 5, 2^2 = 4.\n2) División: 125 ÷ 5 = 25; paréntesis: 5 + 4 = 9.\n3) Operamos: 25 - 9 = 16; 16 + 1 = 17."
      },
      {
        expr: "[4^3 - (√64 + 3^2)] ÷ 2",
        answer: 23.5,
        explanation: "1) Potencias y raíz: 4^3 = 64, √64 = 8, 3^2 = 9.\n2) Paréntesis: 8 + 9 = 17; resta: 64 - 17 = 47.\n3) División: 47 ÷ 2 = 23.5."
      },
      {
        expr: "{√121 - 2^3} + [6^2 ÷ 3] - 5",
        answer: 10,
        explanation: "1) Raíz y potencias: √121 = 11, 2^3 = 8, 6^2 = 36.\n2) Paréntesis: 11 - 8 = 3; división: 36 ÷ 3 = 12.\n3) Operamos: 3 + 12 - 5 = 10."
      },
      {
        expr: "[7^2 + 2^3 - √81] ÷ 3",
        answer: 16,
        explanation: "1) Potencias y raíz: 7^2 = 49, 2^3 = 8, √81 = 9.\n2) Corchete: 49 + 8 - 9 = 48.\n3) División: 48 ÷ 3 = 16."
      },
      {
        expr: "{3^4 - [2 × (√36 + 4)]} ÷ 4",
        answer: 15.25,
        explanation: "1) Potencias y raíz: 3^4 = 81, √36 = 6.\n2) Paréntesis interno: 6 + 4 = 10; producto: 2 × 10 = 20.\n3) Operamos: 81 - 20 = 61; luego 61 ÷ 4 = 15.25."
      },
      {
        expr: "[5^2 - 2^3 + √49 - 10] × 2",
        answer: 28,
        explanation: "1) Potencias y raíz: 5^2 = 25, 2^3 = 8, √49 = 7.\n2) Corchete: 25 - 8 + 7 - 10 = 14.\n3) Multiplicamos: 14 × 2 = 28."
      },
      {
        expr: "{(4^2 + √64) ÷ 2} - [3^2 - 4]",
        answer: 7,
        explanation: "1) Potencias y raíz: 4^2 = 16, √64 = 8, 3^2 = 9.\n2) División: (16 + 8) ÷ 2 = 24 ÷ 2 = 12.\n3) Corchete: 9 - 4 = 5; 12 - 5 = 7."
      },
      {
        expr: "[6^2 - √36 - 2^3] + {4^2 - 9}",
        answer: 29,
        explanation: "1) Potencias y raíz: 6^2 = 36, √36 = 6, 2^3 = 8, 4^2 = 16.\n2) Primer bloque: 36 - 6 - 8 = 22.\n3) Segundo bloque: 16 - 9 = 7; sumamos: 22 + 7 = 29."
      },
      {
        expr: "{√144 - (5^2 - 2^2)} × 3",
        answer: -27,
        explanation: "1) Raíz y potencias: √144 = 12, 5^2 = 25, 2^2 = 4.\n2) Paréntesis: 25 - 4 = 21; resta: 12 - 21 = -9.\n3) Multiplicamos: -9 × 3 = -27."
      },
      {
        expr: "[8^2 - (√64 + 4^2)] ÷ 2 + 1",
        answer: 21,
        explanation: "1) Potencias y raíz: 8^2 = 64, √64 = 8, 4^2 = 16.\n2) Paréntesis: 8 + 16 = 24; resta: 64 - 24 = 40.\n3) División y suma: 40 ÷ 2 = 20; 20 + 1 = 21."
      }
    ];

    // ----- Estado de la aplicación -----

    let nombreEstudiante = "";
    let grupoEstudiante = "";
    let nivelEstudiante = "basico";
    let reactivosSesion = [];
    let indiceActual = 0;
    let aciertos = 0;
    let modoResponder = true; // true: responder, false: siguiente

    // ----- Utilidades -----

    function mezclarArray(array) {
      const copia = array.slice();
      for (let i = copia.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        const temp = copia[i];
        copia[i] = copia[j];
        copia[j] = temp;
      }
      return copia;
    }

    function nivelLegible(codigo) {
      if (codigo === "basico") return "Básico";
      if (codigo === "ampliado") return "Ampliado";
      if (codigo === "super") return "Súper avanzado";
      return "—";
    }

    function sonNumerosIguales(a, b) {
      return Math.abs(a - b) < 1e-9;
    }

    // ----- DOM -----

    const studentNameInput = document.getElementById("studentName");
    const studentGroupInput = document.getElementById("studentGroup");
    const levelSelect = document.getElementById("levelSelect");
    const saveButton = document.getElementById("saveButton");

    const displayNombre = document.getElementById("displayNombre");
    const displayGrupo = document.getElementById("displayGrupo");
    const displayNivel = document.getElementById("displayNivel");

    const ejercicioHeader = document.getElementById("ejercicioHeader");
    const exprBox = document.getElementById("exprBox");
    const aciertosSpan = document.getElementById("aciertosSpan");

    const answerInput = document.getElementById("answerInput");
    const actionButton = document.getElementById("actionButton");

    const feedbackDiv = document.getElementById("feedback");
    const explanationDiv = document.getElementById("explanation");

    const resumenBox = document.getElementById("resumenBox");
    const summaryNombre = document.getElementById("summaryNombre");
    const summaryGrupo = document.getElementById("summaryGrupo");
    const summaryNivel = document.getElementById("summaryNivel");
    const summaryAciertos = document.getElementById("summaryAciertos");
    const summaryPorcentaje = document.getElementById("summaryPorcentaje");
    const summaryFecha = document.getElementById("summaryFecha");

    // ----- Lógica principal -----

    function actualizarPanelDatosVisibles() {
      displayNombre.textContent = nombreEstudiante || "---";
      displayGrupo.textContent = grupoEstudiante || "---";
      displayNivel.textContent = nivelLegible(nivelEstudiante);
    }

    function limpiarRetroalimentacion() {
      feedbackDiv.textContent = "";
      feedbackDiv.classList.remove("correcto", "incorrecto");
      feedbackDiv.style.display = "none";
      explanationDiv.textContent = "";
      explanationDiv.style.display = "none";
    }

    function crearReactivosSesion() {
      let banco;
      if (nivelEstudiante === "basico") {
        banco = reactivosBasicos;
      } else if (nivelEstudiante === "ampliado") {
        banco = reactivosAmpliados;
      } else {
        banco = reactivosSuperAvanzados;
      }

      if (!banco || banco.length === 0) {
        reactivosSesion = [];
        ejercicioHeader.textContent = "Sin reactivos para este nivel";
        exprBox.textContent = "No hay reactivos disponibles. Revisa la configuración del nivel.";
        answerInput.disabled = true;
        actionButton.disabled = true;
        return;
      }

      const mezclados = mezclarArray(banco);
      reactivosSesion = mezclados.slice(0, 15);
      indiceActual = 0;
      aciertos = 0;
      modoResponder = true;
      aciertosSpan.textContent = "0";
      ejercicioHeader.textContent = "Ejercicio 1 de 15";
      exprBox.textContent = reactivosSesion[0].expr;

      answerInput.value = "";
      answerInput.disabled = false;
      answerInput.focus();
      actionButton.disabled = false;
      actionButton.textContent = "Responder";

      limpiarRetroalimentacion();
      resumenBox.style.display = "none";
    }

    function mostrarReactivoActual() {
      if (!reactivosSesion || reactivosSesion.length === 0) {
        ejercicioHeader.textContent = "Guarda tus datos para iniciar la sesión";
        exprBox.textContent = "Guarda tus datos y selecciona un nivel para generar los reactivos.";
        return;
      }

      const numero = indiceActual + 1;
      ejercicioHeader.textContent = "Ejercicio " + numero + " de 15";
      exprBox.textContent = reactivosSesion[indiceActual].expr;
    }

    function evaluarRespuesta() {
      if (!reactivosSesion || reactivosSesion.length === 0) return;

      const reactivo = reactivosSesion[indiceActual];
      let texto = answerInput.value.trim();

      if (texto === "") {
        feedbackDiv.textContent = "Por favor, escribe un número como respuesta.";
        feedbackDiv.classList.remove("correcto", "incorrecto");
        feedbackDiv.classList.add("incorrecto");
        feedbackDiv.style.display = "block";
        explanationDiv.textContent = "";
        explanationDiv.style.display = "none";
        return;
      }

      texto = texto.replace(",", ".");
      const valorUsuario = parseFloat(texto);

      if (Number.isNaN(valorUsuario)) {
        feedbackDiv.textContent =
          "La respuesta debe ser un número válido: entero o decimal (puede ser negativo).";
        feedbackDiv.classList.remove("correcto", "incorrecto");
        feedbackDiv.classList.add("incorrecto");
        feedbackDiv.style.display = "block";
        explanationDiv.textContent = "";
        explanationDiv.style.display = "none";
        return;
      }

      if (sonNumerosIguales(valorUsuario, reactivo.answer)) {
        aciertos += 1;
        aciertosSpan.textContent = String(aciertos);
        feedbackDiv.textContent = "¡Correcto! Tu resultado coincide con el esperado.";
        feedbackDiv.classList.remove("incorrecto");
        feedbackDiv.classList.add("correcto");
      } else {
        feedbackDiv.textContent = "Respuesta incorrecta. El resultado correcto es: " + reactivo.answer + ".";
        feedbackDiv.classList.remove("correcto");
        feedbackDiv.classList.add("incorrecto");
      }

      feedbackDiv.style.display = "block";
      explanationDiv.textContent = reactivo.explanation;
      explanationDiv.style.display = "block";

      modoResponder = false;
      if (indiceActual === reactivosSesion.length - 1) {
        actionButton.textContent = "Terminar";
      } else {
        actionButton.textContent = "Siguiente";
      }
    }

    function mostrarResumen() {
      ejercicioHeader.textContent = "Sesión terminada";

      summaryNombre.textContent = nombreEstudiante || "---";
      summaryGrupo.textContent = grupoEstudiante || "---";
      summaryNivel.textContent = nivelLegible(nivelEstudiante);
      summaryAciertos.textContent = String(aciertos);

      const porcentaje = (aciertos / 15) * 100;
      summaryPorcentaje.textContent = porcentaje.toFixed(2);

      const fecha = new Date();
      summaryFecha.textContent = fecha.toLocaleString("es-MX", {
        dateStyle: "short",
        timeStyle: "short"
      });

      resumenBox.style.display = "block";

      answerInput.disabled = true;
      actionButton.disabled = true;
    }

    function avanzarReactivo() {
      if (!reactivosSesion || reactivosSesion.length === 0) return;

      if (indiceActual >= reactivosSesion.length - 1) {
        mostrarResumen();
        modoResponder = false;
        return;
      }

      indiceActual += 1;
      mostrarReactivoActual();

      answerInput.value = "";
      answerInput.disabled = false;
      answerInput.focus();
      actionButton.disabled = false;
      actionButton.textContent = "Responder";

      limpiarRetroalimentacion();
      modoResponder = true;
    }

    function guardarDatosEstudiante() {
      nombreEstudiante = studentNameInput.value.trim();
      grupoEstudiante = studentGroupInput.value.trim();
      nivelEstudiante = levelSelect.value;

      localStorage.setItem("pm1_nombre", nombreEstudiante);
      localStorage.setItem("pm1_grupo", grupoEstudiante);
      localStorage.setItem("pm1_nivel", nivelEstudiante);

      actualizarPanelDatosVisibles();
      crearReactivosSesion();
    }

    function cargarConfiguracionDesdeLocalStorage() {
      const nombreGuardado = localStorage.getItem("pm1_nombre");
      const grupoGuardado = localStorage.getItem("pm1_grupo");
      const nivelGuardado = localStorage.getItem("pm1_nivel");

      if (nombreGuardado !== null) {
        nombreEstudiante = nombreGuardado;
        studentNameInput.value = nombreGuardado;
      }
      if (grupoGuardado !== null) {
        grupoEstudiante = grupoGuardado;
        studentGroupInput.value = grupoGuardado;
      }
      if (nivelGuardado === "basico" || nivelGuardado === "ampliado" || nivelGuardado === "super") {
        nivelEstudiante = nivelGuardado;
        levelSelect.value = nivelGuardado;
      }

      actualizarPanelDatosVisibles();

      if (nombreGuardado || grupoGuardado || nivelGuardado) {
        crearReactivosSesion();
      } else {
        ejercicioHeader.textContent = "Ejercicio 0 de 15";
        exprBox.textContent = "Guarda tus datos para iniciar la sesión.";
        answerInput.disabled = true;
        actionButton.disabled = true;
      }
    }

    function manejarClickBoton() {
      if (modoResponder) {
        evaluarRespuesta();
      } else {
        avanzarReactivo();
      }
    }

    // ----- Inicialización -----

    function inicializar() {
      saveButton.addEventListener("click", guardarDatosEstudiante);
      actionButton.addEventListener("click", manejarClickBoton);

      answerInput.addEventListener("keydown", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          if (!actionButton.disabled) {
            manejarClickBoton();
          }
        }
      });

      cargarConfiguracionDesdeLocalStorage();
    }

    document.addEventListener("DOMContentLoaded", inicializar);
  </script>
</body>
</html>
