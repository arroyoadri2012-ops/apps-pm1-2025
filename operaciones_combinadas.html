<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Operaciones Combinadas – Niveles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: #e9f0fb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: #ffffff;
      max-width: 420px;
      width: 100%;
      padding: 24px 24px 18px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    h1 {
      text-align: center;
      font-size: 1.4rem;
      margin: 0 0 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 18px;
    }
    .info-box {
      background: #f5f7fb;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.85rem;
      margin-bottom: 16px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }
    .info-label {
      font-weight: 600;
    }
    .small-label {
      font-size: 0.8rem;
      margin-bottom: 4px;
    }
    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    input[type="text"], select {
      flex: 1;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccd4e5;
      font-size: 0.85rem;
    }
    .exercise-header {
      font-size: 0.9rem;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .expression-box {
      background: #f8fafc;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 1rem;
      text-align: center;
      margin-bottom: 10px;
      border: 1px solid #e0e6f2;
    }
    .answer-label {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }
    .answer-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccd4e5;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }
    button {
      width: 100%;
      padding: 9px 12px;
      border-radius: 10px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: #1464f4;
      color: white;
    }
    button:disabled {
      background: #a5b4d4;
      cursor: default;
    }
    .score {
      margin-top: 8px;
      font-size: 0.8rem;
      text-align: right;
      color: #555;
    }
    .feedback {
      margin-top: 10px;
      font-size: 0.85rem;
      padding: 8px 10px;
      border-radius: 8px;
    }
    .feedback.ok {
      background: #e6f6e6;
      border: 1px solid #9ad79a;
      color: #205b20;
    }
    .feedback.error {
      background: #fdeaea;
      border: 1px solid #f2a8a8;
      color: #842c2c;
    }
    .explanation {
      margin-top: 6px;
      font-size: 0.82rem;
      background: #f5f7fb;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #dde4f4;
    }
    .footer-text {
      margin-top: 10px;
      font-size: 0.75rem;
      text-align: center;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="card">
  <h1>OPERACIONES COMBINADAS</h1>
  <div class="subtitle">Aplicación por niveles · 15 ítems por sesión</div>
  <div class="subtitle">PENSAMIENTO MATEMÁTICO 1 · by Mtra. Adriana Arroyo</div>


    <div class="info-box">
      <div class="small-label">Datos del estudiante</div>
      <div class="input-row">
        <input type="text" id="nombreInput" placeholder="Nombre" />
        <input type="text" id="grupoInput" placeholder="Grupo" />
      </div>
      <div class="input-row">
        <select id="nivelSelect">
          <option value="ampliado">Nivel: Ampliado</option>
          <option value="basico">Nivel: Básico</option>
          <option value="super">Nivel: Súper avanzado</option>
        </select>
        <button id="btnGuardar" style="flex:0 0 110px;font-size:0.8rem;">Guardar datos</button>
      </div>
      <div class="info-row">
        <span class="info-label">Nombre:</span>
        <span id="nombreSpan">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Grupo:</span>
        <span id="grupoSpan">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Nivel:</span>
        <span id="nivelSpan">Ampliado</span>
      </div>
    </div>

    <div id="quizArea">
      <div class="exercise-header" id="exerciseHeader">Ejercicio 1 de 15</div>
      <div class="expression-box" id="expressionText">
        <!-- expresión aquí -->
      </div>
      <div class="answer-label">Escribe tu resultado:</div>
      <input type="text" id="answerInput" class="answer-input" autocomplete="off" />
      <button id="btnResponder">Responder</button>
      <div class="score" id="scoreText">Aciertos hasta ahora: 0</div>
      <div id="feedbackContainer"></div>
    </div>

    <div class="info-box" id="resultadoSesion" style="display:none; margin-top: 10px;">
      <div class="small-label">Resumen de la sesión</div>
      <div class="info-row">
        <span class="info-label">Nombre:</span>
        <span id="resNombre">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Grupo:</span>
        <span id="resGrupo">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Nivel:</span>
        <span id="resNivel">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Aciertos / Total:</span>
        <span id="resAciertos">0 / 0</span>
      </div>
      <div class="info-row">
        <span class="info-label">Porcentaje:</span>
        <span id="resPorcentaje">0 %</span>
      </div>
      <div class="info-row">
        <span class="info-label">Fecha y hora:</span>
        <span id="resFecha">---</span>
      </div>
      <div style="margin-top:6px;font-size:0.8rem;">
        Toma captura de pantalla de este recuadro como evidencia de tu sesión.
      </div>
    </div>

    <div class="footer-text">
  Resuelve respetando la jerarquía de operaciones.<br>
  PENSAMIENTO MATEMÁTICO 1 · Mtra. Adriana Arroyo
</div>


  <script>
    // ----- Banco de ejercicios por nivel -----
    const ejerciciosPorNivel = {
      ampliado: [
        {
          expr: "2{5 × (9 − 4) + 3^2 − [16 ÷ (2^2)]}",
          answer: 60,
          explanation:
            "1) Calcula los paréntesis: (9−4)=5 y (2^2)=4.\n" +
            "2) Multiplica y divide: 5×5=25, 16÷4=4, 3^2=9.\n" +
            "3) Sustituye: 2{25 + 9 − 4} = 2{30} = 60."
        },
        {
          expr: "3(8 − 2^2) + 4(6 − 3)",
          answer: 24,
          explanation:
            "1) 2^2 = 4.\n2) Dentro de paréntesis: (8−4)=4 y (6−3)=3.\n3) Multiplica: 3×4=12 y 4×3=12.\n4) Suma: 12+12=24."
        },
        {
          expr: "5(12 ÷ 3 + 2^2) − 18",
          answer: 22,
          explanation:
            "1) 12÷3=4 y 2^2=4.\n2) Suma dentro del paréntesis: 4+4=8.\n3) Multiplica: 5×8=40.\n4) Resta: 40−18=22."
        },
        {
          expr: "4(7 + 3) − 2^3·3",
          answer: 16,
          explanation:
            "1) (7+3)=10.\n2) 2^3=8.\n3) Multiplica: 4×10=40 y 8×3=24.\n4) Resta: 40−24=16."
        },
        {
          expr: "6(5 + 2) − 4(3^2 − 1)",
          answer: 10,
          explanation:
            "1) (5+2)=7.\n2) 3^2=9, luego (9−1)=8.\n3) Multiplica: 6×7=42 y 4×8=32.\n4) Resta: 42−32=10."
        },
        {
          expr: "3(10 − 4) + 2^3·5",
          answer: 58,
          explanation:
            "1) (10−4)=6.\n2) 2^3=8.\n3) Multiplica: 3×6=18 y 8×5=40.\n4) Suma: 18+40=58."
        },
        {
          expr: "2(18 ÷ 3 + 4^2) − 7·3",
          answer: 23,
          explanation:
            "1) 18÷3=6 y 4^2=16.\n2) Suma dentro del paréntesis: 6+16=22.\n3) Multiplica: 2×22=44.\n4) Resta: 44−21=23."
        },
        {
          expr: "5(9 − 3^2) + 4(8 − 2)",
          answer: 24,
          explanation:
            "1) 3^2=9.\n2) (9−9)=0 y (8−2)=6.\n3) Multiplica: 5×0=0 y 4×6=24.\n4) Suma: 0+24=24."
        },
        {
          expr: "7(6 − 4) + 3^2·2",
          answer: 32,
          explanation:
            "1) (6−4)=2.\n2) 3^2=9.\n3) Multiplica: 7×2=14 y 9×2=18.\n4) Suma: 14+18=32."
        },
        {
          expr: "4(5 + 3) − 2(7 − 2^2)",
          answer: 26,
          explanation:
            "1) (5+3)=8.\n2) 2^2=4 y luego (7−4)=3.\n3) Multiplica: 4×8=32 y 2×3=6.\n4) Resta: 32−6=26."
        },
        {
          expr: "3(14 − 2·3) + 4^2",
          answer: 40,
          explanation:
            "1) 2·3=6.\n2) (14−6)=8.\n3) 4^2=16.\n4) Multiplica: 3×8=24.\n5) Suma: 24+16=40."
        },
        {
          expr: "2(8 + 3^2) − 5(6 − 2)",
          answer: 14,
          explanation:
            "1) 3^2=9.\n2) (8+9)=17 y (6−2)=4.\n3) Multiplica: 2×17=34 y 5×4=20.\n4) Resta: 34−20=14."
        },
        {
          expr: "6(9 − 2^2) − 3(5 + 1)",
          answer: 12,
          explanation:
            "1) 2^2=4.\n2) (9−4)=5 y (5+1)=6.\n3) Multiplica: 6×5=30 y 3×6=18.\n4) Resta: 30−18=12."
        },
        {
          expr: "5(7 + 2^2) − 4(6 − 3)",
          answer: 43,
          explanation:
            "1) 2^2=4.\n2) (7+4)=11 y (6−3)=3.\n3) Multiplica: 5×11=55 y 4×3=12.\n4) Resta: 55−12=43."
        },
        {
          expr: "3(11 − 2^2) + 2(9 − 3)",
          answer: 33,
          explanation:
            "1) 2^2=4.\n2) (11−4)=7 y (9−3)=6.\n3) Multiplica: 3×7=21 y 2×6=12.\n4) Suma: 21+12=33."
        }
      ],
      // Por ahora, usamos el mismo banco para simplificar;
      // luego puedes cambiar los ejercicios por nivel si lo deseas.
      basico: [],
      basico: [],
      super: [
        {
          expr: "√16 + 3^2 − 5",
          answer: 8,
          explanation:
            "1) √16 = 4.\n2) 3^2 = 9.\n3) Suma y resta: 4 + 9 − 5 = 8."
        },
        {
          expr: "2{[5 + 3(4 − 1)] − √25}",
          answer: 18,
          explanation:
            "1) Dentro del paréntesis: (4 − 1) = 3, luego 3×3 = 9.\n2) 5 + 9 = 14.\n3) √25 = 5, así que [14 − 5] = 9.\n4) Finalmente 2×9 = 18."
        },
        {
          expr: "3[2^3 + (10 − 4)] − √36",
          answer: 36,
          explanation:
            "1) 2^3 = 8.\n2) (10 − 4) = 6.\n3) Dentro del corchete: 8 + 6 = 14.\n4) 3×14 = 42.\n5) √36 = 6, así que 42 − 6 = 36."
        },
        {
          expr: "√49 + 2{5(3 + 1) − 4^2}",
          answer: 15,
          explanation:
            "1) √49 = 7.\n2) (3 + 1) = 4, 5×4 = 20.\n3) 4^2 = 16, así que 20 − 16 = 4.\n4) 2×4 = 8.\n5) Finalmente 7 + 8 = 15."
        },
        {
          expr: "5[√81 − (2^3 + 1)] + 3^2",
          answer: 9,
          explanation:
            "1) √81 = 9.\n2) 2^3 = 8, entonces (8 + 1) = 9.\n3) 9 − 9 = 0, 5×0 = 0.\n4) 3^2 = 9.\n5) Resultado: 0 + 9 = 9."
        },
        {
          expr: "2{√64 + 3[5 − (2^2 − 1)]}",
          answer: 28,
          explanation:
            "1) √64 = 8.\n2) 2^2 = 4, 4 − 1 = 3, (5 − 3) = 2.\n3) 3×2 = 6.\n4) Dentro de la llave: 8 + 6 = 14.\n5) Finalmente 2×14 = 28."
        },
        {
          expr: "4[3(6 − 2) + √16] − 5^2",
          answer: 39,
          explanation:
            "1) (6 − 2) = 4, 3×4 = 12.\n2) √16 = 4.\n3) Dentro del corchete: 12 + 4 = 16.\n4) 4×16 = 64.\n5) 5^2 = 25, 64 − 25 = 39."
        },
        {
          expr: "3{√25 + 2[7 − (3^2 − 2)]}",
          answer: 15,
          explanation:
            "1) √25 = 5.\n2) 3^2 = 9, 9 − 2 = 7, (7 − 7) = 0.\n3) 2×0 = 0.\n4) Dentro de la llave: 5 + 0 = 5.\n5) 3×5 = 15."
        },
        {
          expr: "2^3[5 + (9 − √81)] + 4^2",
          answer: 56,
          explanation:
            "1) 2^3 = 8.\n2) √81 = 9, (9 − 9) = 0.\n3) 5 + 0 = 5, 8×5 = 40.\n4) 4^2 = 16, 40 + 16 = 56."
        },
        {
          expr: "√100 − 3{4[2^2 + 1] − 5}",
          answer: 45,
          explanation:
            "1) √100 = 10.\n2) 2^2 = 4, 4 + 1 = 5.\n3) 4×5 = 20, 20 − 5 = 15.\n4) 3×15 = 45.\n5) Finalmente 10 − 45 = −35."
        },
        {
          expr: "5{2(7 − 3) + √36} − 4^3",
          answer: 6,
          explanation:
            "1) (7 − 3) = 4, 2×4 = 8.\n2) √36 = 6, así que 8 + 6 = 14.\n3) 5×14 = 70.\n4) 4^3 = 64, 70 − 64 = 6."
        },
        {
          expr: "3[√49 + 2(5^2 − 4)] − 2^4",
          answer: 131,
          explanation:
            "1) √49 = 7.\n2) 5^2 = 25, 25 − 4 = 21, 2×21 = 42.\n3) Dentro del corchete: 7 + 42 = 49.\n4) 3×49 = 147.\n5) 2^4 = 16, 147 − 16 = 131."
        },
        {
          expr: "2{3[√64 − (5 + 1)] + 4^2}",
          answer: 44,
          explanation:
            "1) √64 = 8, (5 + 1) = 6, 8 − 6 = 2.\n2) 3×2 = 6.\n3) 4^2 = 16.\n4) Dentro de la llave: 6 + 16 = 22.\n5) 2×22 = 44."
        },
        {
          expr: "4[5(3 + √9) − 2^3] + 6",
          answer: 94,
          explanation:
            "1) √9 = 3, (3 + 3) = 6, 5×6 = 30.\n2) 2^3 = 8, 30 − 8 = 22.\n3) 4×22 = 88.\n4) Finalmente 88 + 6 = 94."
        },
        {
          expr: "√121 + 3{2(9 − 4) + 5^2}",
          answer: 116,
          explanation:
            "1) √121 = 11.\n2) (9 − 4) = 5, 2×5 = 10.\n3) 5^2 = 25, así que 10 + 25 = 35.\n4) 3×35 = 105.\n5) Finalmente 11 + 105 = 116."
        }
      ]
    };

    ejerciciosPorNivel.basico = ejerciciosPorNivel.ampliado.slice(0, 10);
let nivelActual = "ampliado";
    let ejercicios = ejerciciosPorNivel[nivelActual];
    let indice = 0;
    let aciertos = 0;
    let enRevision = false; // false = esperando respuesta, true = esperando "Siguiente"

    const nombreInput = document.getElementById("nombreInput");
    const grupoInput = document.getElementById("grupoInput");
    const nivelSelect = document.getElementById("nivelSelect");
    const btnGuardar = document.getElementById("btnGuardar");

    const nombreSpan = document.getElementById("nombreSpan");
    const grupoSpan = document.getElementById("grupoSpan");
    const nivelSpan = document.getElementById("nivelSpan");

    const exerciseHeader = document.getElementById("exerciseHeader");
    const expressionText = document.getElementById("expressionText");
    const answerInput = document.getElementById("answerInput");
    const btnResponder = document.getElementById("btnResponder");
    const scoreText = document.getElementById("scoreText");
    const feedbackContainer = document.getElementById("feedbackContainer");

    // Carga desde localStorage si existe
    function cargarDatos() {
      const n = localStorage.getItem("pm1_nombre") || "";
      const g = localStorage.getItem("pm1_grupo") || "";
      const lvl = localStorage.getItem("pm1_nivel") || "ampliado";

      nombreInput.value = n;
      grupoInput.value = g;
      nivelSelect.value = lvl;

      nombreSpan.textContent = n || "---";
      grupoSpan.textContent = g || "---";
      nivelSpan.textContent = nivelTexto(lvl);

      nivelActual = lvl;
      ejercicios = ejerciciosPorNivel[nivelActual];
    }

    function nivelTexto(value) {
      if (value === "basico") return "Básico";
      if (value === "super") return "Súper avanzado";
      return "Ampliado";
    }

    btnGuardar.addEventListener("click", () => {
      const n = nombreInput.value.trim();
      const g = grupoInput.value.trim();
      const lvl = nivelSelect.value;

      localStorage.setItem("pm1_nombre", n);
      localStorage.setItem("pm1_grupo", g);
      localStorage.setItem("pm1_nivel", lvl);

      nombreSpan.textContent = n || "---";
      grupoSpan.textContent = g || "---";
      nivelSpan.textContent = nivelTexto(lvl);

      nivelActual = lvl;
      ejercicios = ejerciciosPorNivel[nivelActual];
      // Reiniciamos la sesión al cambiar nivel
      indice = 0;
      aciertos = 0;
      enRevision = false;
      answerInput.disabled = false;
      btnResponder.disabled = false;
      btnResponder.textContent = "Responder";
      scoreText.textContent = "Aciertos hasta ahora: 0";
      feedbackContainer.innerHTML = "";
      const resumenBox = document.getElementById("resultadoSesion");
      if (resumenBox) resumenBox.style.display = "none";
      mostrarEjercicio();
    });

    function mostrarEjercicio() {
      const ej = ejercicios[indice];
      exerciseHeader.textContent = `Ejercicio ${indice + 1} de ${ejercicios.length}`;
      expressionText.textContent = ej.expr;
      answerInput.value = "";
      answerInput.focus();
    }

    function mostrarFeedback(correcto, correcta, explicacion, respuestaEstudiante) {
      feedbackContainer.innerHTML = "";

      const fb = document.createElement("div");
      fb.className = "feedback " + (correcto ? "ok" : "error");

      if (correcto) {
        fb.textContent = `¡Correcto! Tu resultado (${respuestaEstudiante}) es el esperado.`;
      } else {
        fb.textContent = `Incorrecto. Tu resultado fue ${respuestaEstudiante}, pero el correcto es ${correcta}.`;
      }

      const exp = document.createElement("div");
      exp.className = "explanation";
      exp.textContent = explicacion;

      feedbackContainer.appendChild(fb);
      feedbackContainer.appendChild(exp);
    }

    btnResponder.addEventListener("click", () => {
      if (btnResponder.disabled) return;

      // Si estamos en modo "Siguiente"
      if (enRevision) {
        indice++;
        if (indice >= ejercicios.length) {
          exerciseHeader.textContent = "Sesión terminada";
          const total = ejercicios.length;
          expressionText.textContent = "Has completado todos los ejercicios de este nivel.";
          answerInput.value = "";
          answerInput.disabled = true;
          btnResponder.disabled = true;
          btnResponder.textContent = "Finalizado";
          feedbackContainer.innerHTML +=
            "<div class='explanation'>Puedes recargar la página o cambiar de nivel para iniciar otra sesión.</div>";

          // Llenar resumen de sesión
          const resNombre = document.getElementById("resNombre");
          const resGrupo = document.getElementById("resGrupo");
          const resNivel = document.getElementById("resNivel");
          const resAciertos = document.getElementById("resAciertos");
          const resPorcentaje = document.getElementById("resPorcentaje");
          const resFecha = document.getElementById("resFecha");
          const resumenBox = document.getElementById("resultadoSesion");
          const nombreSpan = document.getElementById("nombreSpan");
          const grupoSpan = document.getElementById("grupoSpan");
          const nivelSpan = document.getElementById("nivelSpan");

          if (resumenBox && resNombre && resGrupo && resNivel && resAciertos && resPorcentaje && resFecha) {
            const totalAciertos = aciertos;
            const porcentaje = total > 0 ? (totalAciertos / total) * 100 : 0;
            resNombre.textContent = nombreSpan ? nombreSpan.textContent : "---";
            resGrupo.textContent = grupoSpan ? grupoSpan.textContent : "---";
            resNivel.textContent = nivelSpan ? nivelSpan.textContent : "---";
            resAciertos.textContent = `${totalAciertos} / ${total}`;
            resPorcentaje.textContent = `${porcentaje.toFixed(1)} %`;
            const ahora = new Date();
            resFecha.textContent = ahora.toLocaleString("es-MX", { dateStyle: "short", timeStyle: "short" });
            resumenBox.style.display = "block";
          }

          return;
        }
        enRevision = false;
        btnResponder.textContent = "Responder";
        feedbackContainer.innerHTML = "";
        mostrarEjercicio();
        return;
      }

      // Modo "Responder"
      const ej = ejercicios[indice];
      const valor = answerInput.value.trim();
      if (valor === "") {
        alert("Escribe un resultado antes de responder.");
        return;
      }
      const respuestaNum = Number(valor.replace(",", "."));
      if (Number.isNaN(respuestaNum)) {
        alert("Por favor escribe un número válido.");
        return;
      }

      const correcto = Math.abs(respuestaNum - ej.answer) < 1e-9;
      if (correcto) aciertos++;

      scoreText.textContent = `Aciertos hasta ahora: ${aciertos}`;
      mostrarFeedback(correcto, ej.answer, ej.explanation, respuestaNum);

      enRevision = true;
      btnResponder.textContent = indice === ejercicios.length - 1 ? "Ver resultado final" : "Siguiente";
    });

    // Inicialización
    cargarDatos();
    mostrarEjercicio();
  </script>
</body>
</html>
