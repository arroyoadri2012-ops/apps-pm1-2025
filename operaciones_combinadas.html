<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Operaciones Combinadas – Niveles</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: #e9f0fb;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
    }
    .card {
      background: #ffffff;
      max-width: 420px;
      width: 100%;
      padding: 24px 24px 18px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
    }
    h1 {
      text-align: center;
      font-size: 1.4rem;
      margin: 0 0 4px;
    }
    .subtitle {
      text-align: center;
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 18px;
    }
    .info-box {
      background: #f5f7fb;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 0.85rem;
      margin-bottom: 16px;
    }
    .info-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 2px;
    }
    .info-label {
      font-weight: 600;
    }
    .small-label {
      font-size: 0.8rem;
      margin-bottom: 4px;
    }
    .input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 10px;
    }
    input[type="text"], select {
      flex: 1;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #ccd4e5;
      font-size: 0.85rem;
    }
    .exercise-header {
      font-size: 0.9rem;
      margin-bottom: 6px;
      font-weight: 600;
    }
    .expression-box {
      background: #f8fafc;
      border-radius: 10px;
      padding: 10px 12px;
      font-size: 1rem;
      text-align: center;
      margin-bottom: 10px;
      border: 1px solid #e0e6f2;
    }
    .answer-label {
      font-size: 0.85rem;
      margin-bottom: 4px;
    }
    .answer-input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccd4e5;
      font-size: 0.95rem;
      margin-bottom: 12px;
    }
    button {
      width: 100%;
      padding: 9px 12px;
      border-radius: 10px;
      border: none;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      background: #1464f4;
      color: white;
    }
    button:disabled {
      background: #a5b4d4;
      cursor: default;
    }
    .score {
      margin-top: 8px;
      font-size: 0.8rem;
      text-align: right;
      color: #555;
    }
    .feedback {
      margin-top: 10px;
      font-size: 0.85rem;
      padding: 8px 10px;
      border-radius: 8px;
    }
    .feedback.ok {
      background: #e6f6e6;
      border: 1px solid #9ad79a;
      color: #205b20;
    }
    .feedback.error {
      background: #fdeaea;
      border: 1px solid #f2a8a8;
      color: #842c2c;
    }
    .explanation {
      margin-top: 6px;
      font-size: 0.82rem;
      background: #f5f7fb;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #dde4f4;
    }
    .footer-text {
      margin-top: 10px;
      font-size: 0.75rem;
      text-align: center;
      color: #666;
    }
  </style>
</head>
<body>
  <div class="card">
  <h1>OPERACIONES COMBINADAS</h1>
  <div class="subtitle">Aplicación por niveles · 15 ítems por sesión</div>
  <div class="subtitle">PENSAMIENTO MATEMÁTICO 1 · by Mtra. Adriana Arroyo</div>


    <div class="info-box">
      <div class="small-label">Datos del estudiante</div>
      <div class="input-row">
        <input type="text" id="nombreInput" placeholder="Nombre" />
        <input type="text" id="grupoInput" placeholder="Grupo" />
      </div>
      <div class="input-row">
        <select id="nivelSelect">
          <option value="ampliado">Nivel: Ampliado</option>
          <option value="basico">Nivel: Básico</option>
          <option value="super">Nivel: Súper avanzado</option>
        </select>
        <button id="btnGuardar" style="flex:0 0 110px;font-size:0.8rem;">Guardar datos</button>
      </div>
      <div class="info-row">
        <span class="info-label">Nombre:</span>
        <span id="nombreSpan">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Grupo:</span>
        <span id="grupoSpan">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Nivel:</span>
        <span id="nivelSpan">Ampliado</span>
      </div>
    </div>

    <div id="quizArea">
      <div class="exercise-header" id="exerciseHeader">Ejercicio 1 de 15</div>
      <div class="expression-box" id="expressionText">
        <!-- expresión aquí -->
      </div>
      <div class="answer-label">Escribe tu resultado:</div>
      <input type="text" id="answerInput" class="answer-input" autocomplete="off" />
      <button id="btnResponder">Responder</button>
      <div class="score" id="scoreText">Aciertos hasta ahora: 0</div>
      <div id="feedbackContainer"></div>
    </div>


    <div class="info-box" id="resultadoSesion" style="display:none; margin-top: 10px;">
      <div class="small-label">Resumen de la sesión</div>
      <div class="info-row">
        <span class="info-label">Nombre:</span>
        <span id="resNombre">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Grupo:</span>
        <span id="resGrupo">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Nivel:</span>
        <span id="resNivel">---</span>
      </div>
      <div class="info-row">
        <span class="info-label">Aciertos / Total:</span>
        <span id="resAciertos">0</span>
      </div>
      <div class="info-row">
        <span class="info-label">Porcentaje:</span>
        <span id="resPorcentaje">0 %</span>
      </div>
      <div class="info-row">
        <span class="info-label">Fecha y hora:</span>
        <span id="resFecha">---</span>
      </div>
      <div style="margin-top:6px;font-size:0.8rem;">
        Toma captura de pantalla de este recuadro como evidencia de tu sesión.
      </div>
    </div>

    <div class="footer-text">
  Resuelve respetando la jerarquía de operaciones.<br>
  PENSAMIENTO MATEMÁTICO 1 · Mtra. Adriana Arroyo
</div>


  <script>
    
    // ----- Banco de ejercicios por nivel -----
    const ejerciciosPorNivel = {
      basico: [
        {
          expr: "6 + 4 × 3",
          answer: 18,
          explanation:
            "Primero multiplicas 4×3=12 y luego sumas 6+12=18."
        },
        {
          expr: "20 − 6 ÷ 3",
          answer: 18,
          explanation:
            "Primero divides 6÷3=2 y luego restas 20−2=18."
        },
        {
          expr: "3 + 2 × (5 − 1)",
          answer: 11,
          explanation:
            "Dentro del paréntesis: 5−1=4. Luego 2×4=8 y finalmente 3+8=11."
        },
        {
          expr: "18 ÷ 3 + 2^2",
          answer: 10,
          explanation:
            "Primero 18÷3=6 y 2^2=4. Luego sumas 6+4=10."
        },
        {
          expr: "4(3 + 2)",
          answer: 20,
          explanation:
            "Resuelve el paréntesis: 3+2=5. Luego multiplicas 4×5=20."
        },
        {
          expr: "2^3 + 5 × 2",
          answer: 18,
          explanation:
            "Calcula 2^3=8. Luego 5×2=10. Finalmente 8+10=18."
        },
        {
          expr: "30 − 2(4 + 3)",
          answer: 16,
          explanation:
            "Primero 4+3=7. Luego 2×7=14. Finalmente 30−14=16."
        },
        {
          expr: "5(2 + 1) − 4",
          answer: 11,
          explanation:
            "Dentro del paréntesis: 2+1=3. Luego 5×3=15 y 15−4=11."
        },
        {
          expr: "24 ÷ (2 × 3)",
          answer: 4,
          explanation:
            "Primero 2×3=6. Luego 24÷6=4."
        },
        {
          expr: "7 + 3^2 − 4",
          answer: 12,
          explanation:
            "Calcula 3^2=9. Luego 7+9=16 y 16−4=12."
        },
        {
          expr: "10 + 6 ÷ 2",
          answer: 13,
          explanation:
            "Primero 6÷2=3. Luego 10+3=13."
        },
        {
          expr: "4^2 − 3 × 2",
          answer: 10,
          explanation:
            "Primero 4^2=16. Luego 3×2=6. Finalmente 16−6=10."
        },
        {
          expr: "2(5 + 3) − 6",
          answer: 10,
          explanation:
            "Dentro del paréntesis: 5+3=8. Luego 2×8=16 y 16−6=10."
        },
        {
          expr: "9 + 2(7 − 4)",
          answer: 15,
          explanation:
            "Calcula 7−4=3. Luego 2×3=6 y 9+6=15."
        },
        {
          expr: "3(4 + 2) + 5",
          answer: 23,
          explanation:
            "Primero 4+2=6. Luego 3×6=18 y 18+5=23."
        }
      ],
      ampliado: [
        {
          expr: "2{5 × (9 − 4) + 3^2 − [16 ÷ (2^2)]}",
          answer: 60,
          explanation:
            "1) Calcula los paréntesis: (9−4)=5 y (2^2)=4.\n" +
            "2) Multiplica y divide: 5×5=25, 16÷4=4, 3^2=9.\n" +
            "3) Sustituye: 2{25 + 9 − 4} = 2{30} = 60."
        },
        {
          expr: "3(8 − 2^2) + 4(6 − 3)",
          answer: 24,
          explanation:
            "1) 2^2 = 4.\n2) Dentro de paréntesis: (8−4)=4 y (6−3)=3.\n3) Multiplica: 3×4=12 y 4×3=12.\n4) Suma: 12+12=24."
        },
        {
          expr: "5(12 ÷ 3 + 2^2) − 18",
          answer: 22,
          explanation:
            "1) 12÷3=4 y 2^2=4.\n2) Suma dentro del paréntesis: 4+4=8.\n3) Multiplica: 5×8=40.\n4) Resta: 40−18=22."
        },
        {
          expr: "4(7 + 3) − 2^3·3",
          answer: 16,
          explanation:
            "1) (7+3)=10.\n2) 2^3=8.\n3) Multiplica: 4×10=40 y 8×3=24.\n4) Resta: 40−24=16."
        },
        {
          expr: "6(5 + 2) − 4(3^2 − 1)",
          answer: 10,
          explanation:
            "1) (5+2)=7.\n2) 3^2=9, luego (9−1)=8.\n3) Multiplica: 6×7=42 y 4×8=32.\n4) Resta: 42−32=10."
        },
        {
          expr: "3(10 − 4) + 2^3·5",
          answer: 58,
          explanation:
            "1) (10−4)=6.\n2) 2^3=8.\n3) Multiplica: 3×6=18 y 8×5=40.\n4) Suma: 18+40=58."
        },
        {
          expr: "2(18 ÷ 3 + 4^2) − 7·3",
          answer: 23,
          explanation:
            "1) 18÷3=6 y 4^2=16.\n2) Suma dentro del paréntesis: 6+16=22.\n3) Multiplica: 2×22=44.\n4) Resta: 44−21=23."
        },
        {
          expr: "5(9 − 3^2) + 4(8 − 2)",
          answer: 24,
          explanation:
            "1) 3^2=9.\n2) (9−9)=0 y (8−2)=6.\n3) Multiplica: 5×0=0 y 4×6=24.\n4) Suma: 0+24=24."
        },
        {
          expr: "7(6 − 4) + 3^2·2",
          answer: 32,
          explanation:
            "1) (6−4)=2.\n2) 3^2=9.\n3) Multiplica: 7×2=14 y 9×2=18.\n4) Suma: 14+18=32."
        },
        {
          expr: "4(5 + 3) − 2(7 − 2^2)",
          answer: 26,
          explanation:
            "1) (5+3)=8.\n2) 2^2=4 y luego (7−4)=3.\n3) Multiplica: 4×8=32 y 2×3=6.\n4) Resta: 32−6=26."
        },
        {
          expr: "3(14 − 2·3) + 4^2",
          answer: 40,
          explanation:
            "1) 2·3=6.\n2) (14−6)=8.\n3) 4^2=16.\n4) Multiplica: 3×8=24.\n5) Suma: 24+16=40."
        },
        {
          expr: "2(8 + 3^2) − 5(6 − 2)",
          answer: 14,
          explanation:
            "1) 3^2=9.\n2) (8+9)=17 y (6−2)=4.\n3) Multiplica: 2×17=34 y 5×4=20.\n4) Resta: 34−20=14."
        },
        {
          expr: "6(9 − 2^2) − 3(5 + 1)",
          answer: 12,
          explanation:
            "1) 2^2=4.\n2) (9−4)=5 y (5+1)=6.\n3) Multiplica: 6×5=30 y 3×6=18.\n4) Resta: 30−18=12."
        },
        {
          expr: "5(7 + 2^2) − 4(6 − 3)",
          answer: 43,
          explanation:
            "1) 2^2=4.\n2) (7+4)=11 y (6−3)=3.\n3) Multiplica: 5×11=55 y 4×3=12.\n4) Resta: 55−12=43."
        },
        {
          expr: "3(11 − 2^2) + 2(9 − 3)",
          answer: 33,
          explanation:
            "1) 2^2=4.\n2) (11−4)=7 y (9−3)=6.\n3) Multiplica: 3×7=21 y 2×6=12.\n4) Suma: 21+12=33."
        }
      ],
      super: [
        {
          expr: "2^2(9 − 3) + 3[4(5 − 2) − 6]",
          answer: 54,
          explanation:
            "1) 2^2=4.\n2) (9−3)=6, (5−2)=3.\n3) 4×3=12 y 12−6=6.\n4) Luego 4×6=24 y 3×6=18.\n5) Finalmente 24+18=42."
        },
        {
          expr: "5[3(4 + 2) − 2^3] + 4",
          answer: 64,
          explanation:
            "1) (4+2)=6.\n2) 3×6=18.\n3) 2^3=8.\n4) Dentro del corchete: 18−8=10.\n5) 5×10=50 y luego 50+4=54."
        },
        {
          expr: "3{2(7 − 3) + 4^2} − 5·2^2",
          answer: 58,
          explanation:
            "1) (7−3)=4, 2×4=8.\n2) 4^2=16.\n3) Dentro de la llave: 8+16=24.\n4) 3×24=72.\n5) 2^2=4 y 5×4=20.\n6) Finalmente 72−20=52."
        },
        {
          expr: "4(6 + 2^2) − 3[5(3 − 1) − 4]",
          answer: 24,
          explanation:
            "1) 2^2=4, 6+4=10.\n2) (3−1)=2, 5×2=10 y luego 10−4=6.\n3) 4×10=40.\n4) 3×6=18.\n5) Finalmente 40−18=22."
        },
        {
          expr: "2[3(5 + 1) − 4^2] + 3^3",
          answer: 26,
          explanation:
            "1) (5+1)=6, 3×6=18.\n2) 4^2=16.\n3) Dentro del corchete: 18−16=2.\n4) 2×2=4.\n5) 3^3=27.\n6) Finalmente 4+27=31."
        },
        {
          expr: "5(4^2 − 3·2) + 2(9 − 5)",
          answer: 78,
          explanation:
            "1) 4^2=16 y 3·2=6.\n2) Dentro del paréntesis: 16−6=10.\n3) 5×10=50.\n4) (9−5)=4, 2×4=8.\n5) Finalmente 50+8=58."
        },
        {
          expr: "3(8 + 2^3) − 4[6 − (3^2 − 2)]",
          answer: 40,
          explanation:
            "1) 2^3=8, 8+8=16.\n2) 3^2=9, 9−2=7.\n3) (6−7)=−1.\n4) 3×16=48.\n5) 4×(−1)=−4.\n6) Finalmente 48−4=44."
        },
        {
          expr: "2{4(7 − 2) + 3[5 − (2^2 − 1)]}",
          answer: 68,
          explanation:
            "1) (7−2)=5, 4×5=20.\n2) 2^2=4, 4−1=3, (5−3)=2.\n3) 3×2=6.\n4) Dentro de la llave: 20+6=26.\n5) 2×26=52."
        },
        {
          expr: "4[3(6 − 2) + 2^3] − 5(7 − 3)",
          answer: 66,
          explanation:
            "1) (6−2)=4, 3×4=12.\n2) 2^3=8.\n3) Dentro del corchete: 12+8=20.\n4) 4×20=80.\n5) (7−3)=4, 5×4=20.\n6) Finalmente 80−20=60."
        },
        {
          expr: "3(5^2 − 4·3) + 2(7 − 2^2)",
          answer: 57,
          explanation:
            "1) 5^2=25 y 4·3=12.\n2) Dentro del paréntesis: 25−12=13.\n3) 2^2=4 y (7−4)=3.\n4) 3×13=39 y 2×3=6.\n5) Finalmente 39+6=45."
        },
        {
          expr: "2^3(9 − 5) + 3[4(2^2 + 1) − 10]",
          answer: 70,
          explanation:
            "1) 2^3=8, (9−5)=4, 8×4=32.\n2) 2^2=4, 4+1=5, 4×5=20.\n3) Dentro del corchete: 20−10=10.\n4) 3×10=30.\n5) Finalmente 32+30=62."
        },
        {
          expr: "5{2(7 − 3) + 3(4^2 − 5)}",
          answer: 110,
          explanation:
            "1) (7−3)=4, 2×4=8.\n2) 4^2=16, 16−5=11, 3×11=33.\n3) Dentro de la llave: 8+33=41.\n4) 5×41=205."
        },
        {
          expr: "4[5(3 + 1) − 2(6 − 2^2)]",
          answer: 64,
          explanation:
            "1) (3+1)=4, 5×4=20.\n2) 2^2=4, (6−4)=2, 2×2=4.\n3) Dentro del corchete: 20−4=16.\n4) 4×16=64."
        },
        {
          expr: "3(2^3 + 5^2) − 4(7 − 3)",
          answer: 71,
          explanation:
            "1) 2^3=8 y 5^2=25.\n2) Suma: 8+25=33.\n3) 3×33=99.\n4) (7−3)=4, 4×4=16.\n5) Finalmente 99−16=83."
        },
        {
          expr: "2[3(9 − 4) + 4(2^2 + 3)]",
          answer: 94,
          explanation:
            "1) (9−4)=5, 3×5=15.\n2) 2^2=4, 4+3=7, 4×7=28.\n3) Dentro del corchete: 15+28=43.\n4) 2×43=86."
        }
      ]
    };
let nivelActual = "ampliado";
    let ejercicios = ejerciciosPorNivel[nivelActual];
    let indice = 0;
    let aciertos = 0;
    let enRevision = false; // false = esperando respuesta, true = esperando "Siguiente"

    const nombreInput = document.getElementById("nombreInput");
    const grupoInput = document.getElementById("grupoInput");
    const nivelSelect = document.getElementById("nivelSelect");
    const btnGuardar = document.getElementById("btnGuardar");

    const nombreSpan = document.getElementById("nombreSpan");
    const grupoSpan = document.getElementById("grupoSpan");
    const nivelSpan = document.getElementById("nivelSpan");

    const exerciseHeader = document.getElementById("exerciseHeader");
    const expressionText = document.getElementById("expressionText");
    const answerInput = document.getElementById("answerInput");
    const btnResponder = document.getElementById("btnResponder");
    const scoreText = document.getElementById("scoreText");
    const feedbackContainer = document.getElementById("feedbackContainer");

    // Carga desde localStorage si existe
    function cargarDatos() {
      const n = localStorage.getItem("pm1_nombre") || "";
      const g = localStorage.getItem("pm1_grupo") || "";
      const lvl = localStorage.getItem("pm1_nivel") || "ampliado";

      nombreInput.value = n;
      grupoInput.value = g;
      nivelSelect.value = lvl;

      nombreSpan.textContent = n || "---";
      grupoSpan.textContent = g || "---";
      nivelSpan.textContent = nivelTexto(lvl);

      nivelActual = lvl;
      ejercicios = ejerciciosPorNivel[nivelActual];
    }

    function nivelTexto(value) {
      if (value === "basico") return "Básico";
      if (value === "super") return "Súper avanzado";
      return "Ampliado";
    }

    btnGuardar.addEventListener("click", () => {
      const n = nombreInput.value.trim();
      const g = grupoInput.value.trim();
      const lvl = nivelSelect.value;

      localStorage.setItem("pm1_nombre", n);
      localStorage.setItem("pm1_grupo", g);
      localStorage.setItem("pm1_nivel", lvl);

      nombreSpan.textContent = n || "---";
      grupoSpan.textContent = g || "---";
      nivelSpan.textContent = nivelTexto(lvl);

      nivelActual = lvl;
      ejercicios = ejerciciosPorNivel[nivelActual];
      // Reiniciamos la sesión al cambiar nivel
      indice = 0;
      aciertos = 0;
      enRevision = false;
      btnResponder.disabled = false;
      btnResponder.textContent = "Responder";
      scoreText.textContent = "Aciertos hasta ahora: 0";
      feedbackContainer.innerHTML = "";
      mostrarEjercicio();
    });

    function mostrarEjercicio() {
      const ej = ejercicios[indice];
      exerciseHeader.textContent = `Ejercicio ${indice + 1} de ${ejercicios.length}`;
      expressionText.textContent = ej.expr;
      answerInput.value = "";
      answerInput.focus();
    }

    function mostrarFeedback(correcto, correcta, explicacion, respuestaEstudiante) {
      feedbackContainer.innerHTML = "";

      const fb = document.createElement("div");
      fb.className = "feedback " + (correcto ? "ok" : "error");

      if (correcto) {
        fb.textContent = `¡Correcto! Tu resultado (${respuestaEstudiante}) es el esperado.`;
      } else {
        fb.textContent = `Incorrecto. Tu resultado fue ${respuestaEstudiante}, pero el correcto es ${correcta}.`;
      }

      const exp = document.createElement("div");
      exp.className = "explanation";
      exp.textContent = explicacion;

      feedbackContainer.appendChild(fb);
      feedbackContainer.appendChild(exp);
    }

    btnResponder.addEventListener("click", () => {
      if (btnResponder.disabled) return;

      // Si estamos en modo "Siguiente"
      if (enRevision) {
        indice++;
        if (indice >= ejercicios.length) {
          exerciseHeader.textContent = "Sesión terminada";
          const total = ejercicios.length;
          expressionText.textContent = "Has completado todos los ejercicios de este nivel.";
          answerInput.value = "";
          answerInput.disabled = true;
          btnResponder.disabled = true;
          btnResponder.textContent = "Finalizado";
          feedbackContainer.innerHTML +=
            "<div class='explanation'>Puedes recargar la página o cambiar de nivel para iniciar otra sesión.</div>";

          // Llenar resumen de sesión para captura de pantalla
          const nombreSpan = document.getElementById("nombreSpan");
          const grupoSpan = document.getElementById("grupoSpan");
          const nivelSpan = document.getElementById("nivelSpan");
          const resNombre = document.getElementById("resNombre");
          const resGrupo = document.getElementById("resGrupo");
          const resNivel = document.getElementById("resNivel");
          const resAciertos = document.getElementById("resAciertos");
          const resPorcentaje = document.getElementById("resPorcentaje");
          const resFecha = document.getElementById("resFecha");
          const resumenBox = document.getElementById("resultadoSesion");

          if (resumenBox && resNombre && resGrupo && resNivel && resAciertos && resPorcentaje && resFecha) {
            const totalAciertos = aciertos;
            const porcentaje = (totalAciertos / total) * 100;
            resNombre.textContent = nombreSpan ? nombreSpan.textContent : "---";
            resGrupo.textContent = grupoSpan ? grupoSpan.textContent : "---";
            resNivel.textContent = nivelSpan ? nivelSpan.textContent : "---";
            resAciertos.textContent = `${totalAciertos} / ${total}`;
            resPorcentaje.textContent = `${porcentaje.toFixed(1)} %`;
            const ahora = new Date();
            resFecha.textContent = ahora.toLocaleString("es-MX", { dateStyle: "short", timeStyle: "short" });
            resumenBox.style.display = "block";
          }

          return;
        }
        enRevision = false;
        btnResponder.textContent = "Responder";
        feedbackContainer.innerHTML = "";
        mostrarEjercicio();
        return;
      }

      // Modo "Responder"
      const ej = ejercicios[indice];
      const valor = answerInput.value.trim();
      if (valor === "") {
        alert("Escribe un resultado antes de responder.");
        return;
      }
      const respuestaNum = Number(valor.replace(",", "."));
      if (Number.isNaN(respuestaNum)) {
        alert("Por favor escribe un número válido.");
        return;
      }

      const correcto = Math.abs(respuestaNum - ej.answer) < 1e-9;
      if (correcto) aciertos++;

      scoreText.textContent = `Aciertos hasta ahora: ${aciertos}`;
      mostrarFeedback(correcto, ej.answer, ej.explanation, respuestaNum);

      enRevision = true;
      btnResponder.textContent = indice === ejercicios.length - 1 ? "Ver resultado final" : "Siguiente";
    });

    // Inicialización
    cargarDatos();
    mostrarEjercicio();
  </script>
</body>
</html>
