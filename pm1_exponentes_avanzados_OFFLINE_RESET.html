<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pensamiento Matemático 1 — Leyes avanzadas de exponentes — Mtra. Adriana Arroyo</title>
<link rel="manifest" href="manifest.json">
<style>
  :root{
    --bg:#0b1117;
    --card:#0f172a;
    --ink:#f8fafc;
    --muted:#cbd5e1;
    --border:#1e293b;
    --pill:#0b1220;
    --accent:#22c55e;
    --accent-soft:#064e3b;
    --error:#ef4444;
    --error-soft:#451a1a;
  }
  *{box-sizing:border-box;}
  body{
    margin:0;
    padding:16px;
    background:radial-gradient(circle at top,#020617,#0b1117 55%);
    color:var(--ink);
    font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial,sans-serif;
  }
  nav{
    padding:8px 0 14px 0;
    border-bottom:1px solid var(--border);
    margin-bottom:12px;
    display:flex;
    flex-wrap:wrap;
    gap:8px;
  }
  nav a{
    text-decoration:none;
    font-size:14px;
    font-weight:600;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--muted);
  }
  nav a.active{
    background:#22c55e;
    color:#020617;
    border-color:#16a34a;
  }
  h1{
    margin:0 0 6px 0;
    font-size:22px;
  }
  .credit{
    margin:4px 0 10px 0;
    color:var(--muted);
    font-size:14px;
  }
  .card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:16px;
    padding:12px;
    margin-bottom:12px;
  }
  label{
    display:block;
    margin-bottom:4px;
    color:var(--muted);
    font-size:14px;
  }
  input,select,button{
    width:100%;
    padding:12px;
    border-radius:12px;
    border:1px solid var(--border);
    background:#020617;
    color:var(--ink);
    font-size:16px;
  }
  select{cursor:pointer;}
  input::placeholder{color:#64748b;}
  button{
    cursor:pointer;
    font-weight:600;
  }
  button.primary{
    background:#22c55e;
    color:#020617;
    border-color:#16a34a;
  }
  button.muted{
    background:#0b1220;
    color:var(--muted);
  }
  button:disabled{
    opacity:0.5;
    cursor:not-allowed;
  }
  .pill{
    display:inline-block;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:var(--pill);
    font-size:13px;
    margin-right:6px;
  }
  .op{
    font-weight:700;
    font-size:18px;
    line-height:1.45;
    min-height:90px;
    margin:8px 0 10px 0;
  }
  .hint{
    color:var(--muted);
    font-size:14px;
    margin-top:4px;
  }
  .btns{
    display:flex;
    gap:8px;
    margin-top:8px;
  }
  .btns button{flex:1;}
  .box{
    border-radius:12px;
    padding:10px;
    margin-top:8px;
  }
  .box.ok{
    background:var(--accent-soft);
    border:1px solid var(--accent);
  }
  .box.error{
    background:var(--error-soft);
    border:1px solid var(--error);
  }
  .meta{
    margin-top:6px;
    color:var(--muted);
    font-size:13px;
  }
  @media (min-width:640px){
    body{max-width:720px;margin:0 auto;}
  }
</style>
</head>
<body>

<nav>
  <a href="pm1_razones_prop_porcent_OFFLINE.html">Razones</a>
  <a href="pm1_regla_de_tres_OFFLINE.html">Regla 3</a>
  <a href="pm1_mcm_mcd_quiz_OFFLINE.html">MCM/MCD</a>
  <a href="pm1_exponentes_OFFLINE (2).html">Exponentes</a>
  <a href="pm1_exponentes_avanzados_OFFLINE_RESET.html" class="active">Exp. avanzados</a>
</nav>

<div class="card">
  <h1>LEYES AVANZADAS DE EXPONENTES</h1>
  <p class="credit">
    by Mtra. Adriana Arroyo • Versión offline • 15 ítems por sesión<br>
    Practica potencia de un producto, potencia de un cociente y combinaciones.
  </p>
</div>

<div class="card">
  <label>Nombre (opcional)</label>
  <input id="studentName" placeholder="Nombre y apellidos" type="text" inputmode="text">
  <label>Grupo (opcional)</label>
  <input id="studentGroup" placeholder="p. ej., 1°A" type="text" inputmode="text">
  <label>Modo</label>
  <select id="mode">
    <option value="mixed" selected>Mixto (todas las leyes avanzadas)</option>
    <option value="prod">Solo potencia de un producto ( (ab)^n )</option>
    <option value="quot">Solo potencia de un cociente ( (a/b)^n )</option>
    <option value="combo">Solo combinaciones de leyes</option>
  </select>
  <button id="startBtn" class="primary">Iniciar (15 ítems)</button>
  <p class="hint">
    Puedes responder en forma de potencia o como número/fracción.<br>
    Ejemplos válidos: <code>(2^2)*(3^2)</code>, <code>36</code>, <code>(4/5)^2</code>.
  </p>
</div>

<div class="card">
  <div id="operation" class="op">Da clic en <strong>Iniciar</strong> para comenzar.</div>
  <input id="answer" type="text" inputmode="text" autocomplete="off" autocorrect="off" spellcheck="false" placeholder="Escribe tu resultado (expresión o número)">
  <div class="btns">
    <button id="checkBtn" class="primary">Comprobar</button>
    <button id="nextBtn" class="muted">Siguiente</button>
  </div>
  <div id="feedback" style="min-height:120px;margin-top:10px;"></div>
</div>

<div class="card">
  <span id="counter" class="pill">Ítem —/15</span>
  <span id="score" class="pill">Aciertos 0</span>
  <span id="streak" class="pill">Racha 0</span>
</div>

<script>
(function(){
  function $(sel){ return document.querySelector(sel); }
  function randInt(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }
  function choice(arr){ return arr[randInt(0,arr.length-1)]; }
  function fixed2(x){ return parseFloat(x.toFixed(2)); }

  function evalUserExpression(raw){
    if(!raw) return NaN;
    var s = String(raw)
      .replace(',', '.')
      .replace(/×|·|x/gi,'*')
      .replace(/\s+/g,'')
      .replace(/\^/g,'**');
    if(!s) return NaN;
    if(!/^[0-9.\\+\\-\\*\\/()]*$/.test(s)){
      return NaN;
    }
    try{
      var val = Function('"use strict";return ('+s+');')();
      if(typeof val === 'number' && isFinite(val)){
        return val;
      }
      return NaN;
    }catch(e){
      return NaN;
    }
  }

  function makeProdItem(){
    var a,b,n,val;
    while(true){
      a = randInt(2,6);
      b = randInt(2,6);
      n = randInt(2,3);
      val = Math.pow(a*b,n);
      if(val <= 2000) break;
    }
    var text = '('+a+'·'+b+')^'+n;
    var explain =
      '<div class="box ok"><strong>Ley: potencia de un producto</strong><br>'+
      '(ab)^n = a^n · b^n.<br>'+
      'Aquí a = '+a+', b = '+b+' y n = '+n+'.<br>'+
      a+'^'+n+' = '+Math.pow(a,n)+', '+b+'^'+n+' = '+Math.pow(b,n)+'.<br>'+
      'Entonces ( '+a+'·'+b+' )^'+n+' = '+Math.pow(a,n)+' · '+Math.pow(b,n)+
      ' = <strong>'+val+'</strong>.</div>';
    return {
      kind:'prod',
      textHtml:'Simplifica: <strong>'+text+'</strong>',
      value:val,
      lawTitle:'Potencia de un producto',
      explain:explain
    };
  }

  function gcd(a,b){
    a=Math.abs(a);b=Math.abs(b);
    while(b){var t=b;b=a%b;a=t;}
    return a;
  }

  function makeQuotItem(){
    var num,den,n;
    var val;
    while(true){
      den = randInt(2,9);
      var k = randInt(2,5);
      num = den*k;
      n = randInt(2,3);
      val = Math.pow(num/den,n);
      if(val <= 500 && val >= 0.01) break;
    }
    var p = Math.pow(num,n);
    var q = Math.pow(den,n);
    var g = gcd(p,q);
    var pS = p/g;
    var qS = q/g;
    var frac = pS+'/'+qS;
    var text = '('+num+'/'+den+')^'+n;
    var explain =
      '<div class="box ok"><strong>Ley: potencia de un cociente</strong><br>'+
      '(a/b)^n = a^n / b^n.<br>'+
      'Aquí a = '+num+', b = '+den+' y n = '+n+'.<br>'+
      num+'^'+n+' = '+p+', '+den+'^'+n+' = '+q+'.<br>'+
      'Al simplificar obtenemos '+frac+
      ' ≈ <strong>'+fixed2(val)+'</strong>.</div>';
    return {
      kind:'quot',
      textHtml:'Simplifica: <strong>'+text+'</strong>',
      value:val,
      lawTitle:'Potencia de un cociente',
      explain:explain
    };
  }

  function makeComboItem(){
    var pattern = choice(['prod-quot','power-of-power','mix']);
    if(pattern === 'prod-quot'){
      var a = randInt(2,5);
      var b = randInt(2,5);
      var n = randInt(2,3);
      var expr = '(('+a+'·'+b+')^'+n+') / '+a+'^'+n;
      var val = Math.pow(b,n);
      var explain =
        '<div class=".box ok"><strong>Combinación de leyes</strong><br>'+
        '1) Aplicamos potencia de un producto:<br>'+
        '(('+a+'·'+b+')^'+n+') = a^'+n+' · b^'+n+'.<br>'+
        '2) Simplificamos con a^'+n+':<br>'+
        'a^'+n+' · b^'+n+' / a^'+n+' = b^'+n+
        ' = <strong>'+val+'</strong>.</div>';
      return {
        kind:'combo',
        textHtml:'Simplifica: <strong>'+expr+'</strong>',
        value:val,
        lawTitle:'Combinación (producto + cociente)',
        explain:explain
      };
    }
    if(pattern === 'power-of-power'){
      var base = randInt(2,6);
      var m = randInt(2,3);
      var n2 = randInt(2,3);
      var expr2 = '('+base+'^'+m+')^'+n2;
      var val2 = Math.pow(base,m*n2);
      var explain2 =
        '<div class="box ok"><strong>Ley: potencia de una potencia</strong><br>'+
        '(a^m)^n = a^{m·n}.<br>'+
        'Aquí a = '+base+', m = '+m+', n = '+n2+'.<br>'+
        'm·n = '+m+'·'+n2+' = '+(m*n2)+'.<br>'+
        '( '+base+'^'+m+' )^'+n2+' = '+base+'^'+(m*n2)+
        ' = <strong>'+val2+'</strong>.</div>';
      return {
        kind:'combo',
        textHtml:'Simplifica: <strong>'+expr2+'</strong>',
        value:val2,
        lawTitle:'Potencia de una potencia',
        explain:explain2
      };
    }
    var a2 = randInt(2,6);
    var m1 = randInt(2,4);
    var m2 = randInt(2,4);
    var k = randInt(2,4);
    var totalExp = m1+m2-k;
    if(totalExp < 0){
      totalExp = Math.abs(totalExp);
    }
    var expr3 = '('+a2+'^'+m1+' · '+a2+'^'+m2+') / '+a2+'^'+k;
    var val3 = Math.pow(a2,totalExp);
    var explain3 =
      '<div class="box ok"><strong>Combinación de leyes</strong><br>'+
      'a^m · a^n = a^{m+n} y a^p / a^q = a^{p−q}.<br>'+
      'a^'+m1+' · a^'+m2+' = a^{'+m1+'+'+m2+'} = a^'+(m1+m2)+'.<br>'+
      'Luego a^'+(m1+m2)+' / a^'+k+
      ' = a^{'+(m1+m2)+'−'+k+'} = a^'+totalExp+
      ' = <strong>'+val3+'</strong>.</div>';
    return {
      kind:'combo',
      textHtml:'Simplifica: <strong>'+expr3+'</strong>',
      value:val3,
      lawTitle:'Combinación (producto y cociente)',
      explain:explain3
    };
  }

  function buildItem(mode){
    if(mode === 'prod') return makeProdItem();
    if(mode === 'quot') return makeQuotItem();
    if(mode === 'combo') return makeComboItem();
    var bucket = choice([makeProdItem, makeQuotItem, makeComboItem]);
    return bucket();
  }

  var state = {
    items:[],
    index:0,
    score:0,
    streak:0
  };

  var operationEl = $('#operation');
  var answerEl    = $('#answer');
  var feedbackEl  = $('#feedback');
  var counterEl   = $('#counter');
  var scoreEl     = $('#score');
  var streakEl    = $('#streak');
  var startBtn    = $('#startBtn');
  var checkBtn    = $('#checkBtn');
  var nextBtn     = $('#nextBtn');

  function renderCurrent(){
    var item = state.items[state.index];
    operationEl.innerHTML = item.textHtml;
    counterEl.textContent = 'Ítem '+(state.index+1)+'/15';
    feedbackEl.innerHTML = '';
    answerEl.value = '';
    answerEl.focus();
  }

  function startQuiz(){
    var mode = document.getElementById('mode').value;
    state.items = [];
    for(var i=0;i<15;i++){
      state.items.push(buildItem(mode));
    }
    state.index = 0;
    state.score = 0;
    state.streak = 0;
    scoreEl.textContent  = 'Aciertos 0';
    streakEl.textContent = 'Racha 0';
    renderCurrent();
  }

  function checkAnswer(){
    if(!state.items.length) return;
    var raw = answerEl.value;
    if(!raw){
      feedbackEl.innerHTML = '<p style="color:#fca5a5">Escribe una respuesta antes de comprobar.</p>';
      return;
    }
    var valUser = evalUserExpression(raw);
    if(isNaN(valUser)){
      feedbackEl.innerHTML = '<div class="box error"><strong>No se pudo leer tu expresión.</strong><br>Revisa paréntesis, signos y que solo uses números y operaciones básicas.</div>';
      return;
    }
    var item = state.items[state.index];
    var correct = item.value;
    var diff = Math.abs(valUser - correct);
    var ok = diff <= 1e-6 * Math.max(1, Math.abs(correct));

    if(ok){
      state.score++;
      state.streak++;
      scoreEl.textContent  = 'Aciertos '+state.score;
      streakEl.textContent = 'Racha '+state.streak;
      feedbackEl.innerHTML =
        '<div class="box ok"><strong>¡Muy bien!</strong><br>Tu resultado es equivalente al correcto.</div>'+
        item.explain;
    }else{
      state.streak = 0;
      streakEl.textContent = 'Racha 0';
      feedbackEl.innerHTML =
        '<div class="box error"><strong>Revisa.</strong><br>'+
        'Valor correcto ≈ <strong>'+correct+'</strong>.<br>'+
        'Tu resultado fue '+valUser+'.</div>'+
        item.explain;
    }
  }

  function nextItem(){
    if(!state.items.length) return;
    if(state.index < state.items.length-1){
      state.index++;
      renderCurrent();
    }else{
      operationEl.innerHTML =
        'Has terminado los 15 ítems. Tu puntaje fue <strong>'+
        state.score+'</strong> de '+state.items.length+'.';
      feedbackEl.innerHTML =
        '<p class="meta">Puedes iniciar de nuevo para practicar más leyes avanzadas de exponentes.</p>';
    }
  }

  startQuiz; // nada, solo para evitar warnings

  startBtn.addEventListener('click', startQuiz);
  checkBtn.addEventListener('click', checkAnswer);
  nextBtn.addEventListener('click', nextItem);
  answerEl.addEventListener('keydown', function(ev){
    if(ev.key === 'Enter'){
      ev.preventDefault();
      checkAnswer();
    }
  });
})();
</script>

<script>
if('serviceWorker' in navigator){
  window.addEventListener('load', function(){
    navigator.serviceWorker.register('service-worker.js')
      .then(function(reg){ console.log('SW registrado:', reg.scope); })
      .catch(function(err){ console.log('Fallo registro de SW:', err); });
  });
}
</script>

</body>
</html>
